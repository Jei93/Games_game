<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industry Evolution Simulator - GOTY Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Pixelify+Sans:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-panel: #2a2a2a;
            --bg-card: #3a3a3a;
            --bg-card-hover: #4a4a4a;
            --neon-green: #00ff41;
            --neon-blue: #00b8ff;
            --neon-yellow: #ffcc00;
            --neon-red: #ff0040;
            --neon-purple: #b967ff;
            --pixel-border: #555555;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
        }

        body {
            font-family: 'Pixelify Sans', monospace;
            background: radial-gradient(ellipse at center, #1a0033 0%, var(--bg-primary) 100%);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        /* üéÆ PIXEL PERFECT RENDERING */
        canvas {
            display: block;
            background: var(--bg-secondary);
            border: 3px solid var(--pixel-border);
            box-shadow: 0 0 20px rgba(0, 184, 255, 0.3);
        }

        /* üìä UI OVERLAY */
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .ui-panel {
            position: absolute;
            background: rgba(26, 26, 26, 0.95);
            border: 3px solid var(--pixel-border);
            padding: 10px;
            pointer-events: all;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ui-panel.hidden {
            transform: translateX(-100%);
        }

        .ui-panel.right {
            right: 0;
        }

        .ui-panel.bottom {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .ui-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            color: var(--neon-blue);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 8px var(--neon-blue);
        }

        .ui-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 10px;
        }

        .ui-stat-label {
            color: var(--text-secondary);
        }

        .ui-stat-value {
            color: var(--neon-green);
            font-weight: 700;
        }

        .ui-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-panel);
            border: 1px solid var(--pixel-border);
            position: relative;
            margin-top: 4px;
            overflow: hidden;
        }

        .ui-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .cash-fill { background: linear-gradient(90deg, var(--neon-green), #00cc33); }
        .team-fill { background: linear-gradient(90deg, var(--neon-blue), #0088cc); }
        .rep-fill { background: linear-gradient(90deg, var(--neon-yellow), #cc9900); }
        .hype-fill { background: linear-gradient(90deg, var(--neon-purple), #9966cc); }

        /* üéÆ BUTTONS */
        .pixel-button {
            font-family: 'Pixelify Sans', monospace;
            font-size: 10px;
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            color: var(--text-primary);
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.15s;
            display: block;
            width: 100%;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .pixel-button:hover {
            background: var(--neon-blue);
            color: var(--bg-dark);
            border-color: var(--neon-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 184, 255, 0.3);
        }

        .pixel-button:active {
            transform: scale(0.95);
        }

        .pixel-button.danger {
            border-color: var(--neon-red);
        }

        .pixel-button.danger:hover {
            background: var(--neon-red);
        }

        .pixel-button.success {
            border-color: var(--neon-green);
        }

        .pixel-button.success:hover {
            background: var(--neon-green);
        }

        /* üéÆ MODAL */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            place-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: grid;
        }

        .modal-content {
            background: var(--bg-panel);
            border: 4px solid var(--pixel-blue);
            padding: 20px;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalPop 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-title {
            font-size: 14px;
            color: var(--neon-blue);
            margin-bottom: 15px;
            text-align: center;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .option-tile {
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-size: 9px;
        }

        .option-tile:hover {
            border-color: var(--neon-blue);
            transform: scale(1.05);
        }

        .option-tile.selected {
            border-color: var(--neon-green);
            background: rgba(0, 255, 65, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
        }

        .option-icon {
            font-size: 16px;
            margin-bottom: 4px;
        }

        /* üéÆ REVIEW MODAL */
        .review-modal .review-score {
            font-size: 48px;
            font-weight: 900;
            color: var(--neon-green);
            text-shadow: 3px 3px 0 var(--bg-dark);
            text-align: center;
            margin: 20px 0;
        }

        .review-modal .review-stars {
            font-size: 24px;
            color: var(--neon-yellow);
            text-align: center;
            margin-bottom: 15px;
        }

        .review-modal .review-comments {
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            padding: 12px;
            font-size: 10px;
            line-height: 1.4;
            margin: 15px 0;
        }

        /* üéÆ ACHIEVEMENT */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, var(--neon-purple), var(--neon-pink));
            border: 4px solid var(--neon-yellow);
            padding: 20px 30px;
            z-index: 2000;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-align: center;
        }

        .achievement-popup.active {
            transform: translate(-50%, -50%) scale(1);
        }

        .achievement-title {
            font-size: 14px;
            font-weight: 900;
            margin-bottom: 5px;
            color: var(--bg-dark);
        }

        .achievement-desc {
            font-size: 10px;
            color: var(--text-primary);
        }

        /* üéÆ NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            right: -400px;
            background: var(--bg-panel);
            border: 2px solid var(--neon-blue);
            padding: 10px 15px;
            max-width: 300px;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1500;
        }

        .notification.show {
            right: 20px;
        }

        .notification-title {
            color: var(--neon-blue);
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 10px;
        }

        .notification-text {
            font-size: 9px;
            color: var(--text-secondary);
        }

        /* üéÆ ANIMATIONS */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .bouncing {
            animation: bounce 0.3s ease-in-out;
        }

        /* üéÆ RESPONSIVE */
        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: 200px 1fr 150px;
            }
            
            .ui-panel.left, .ui-panel.right {
                position: relative;
                width: 100%;
                height: 100%;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="1920" height="1080"></canvas>

    <!-- üéÆ UI OVERLAY -->
    <div class="ui-overlay">
        <!-- LEFT PANEL - RESOURCES -->
        <div class="ui-panel left" id="leftPanel">
            <div class="ui-title">üìä STUDIO RESOURCES</div>
            
            <div class="ui-stat">
                <span class="ui-stat-label">üí∞ CASH</span>
                <span class="ui-stat-value" id="uiCash">$500K</span>
            </div>
            <div class="ui-bar"><div class="ui-fill cash-fill" id="cashBar" style="width: 50%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">üë• TEAM</span>
                <span class="ui-stat-value" id="uiTeam">15 / 50</span>
            </div>
            <div class="ui-bar"><div class="ui-fill team-fill" id="teamBar" style="width: 30%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">‚≠ê REPUTATION</span>
                <span class="ui-stat-value" id="uiRep">65%</span>
            </div>
            <div class="ui-bar"><div class="ui-fill rep-fill" id="repBar" style="width: 65%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">üî• HYPE</span>
                <span class="ui-stat-value" id="uiHype">30%</span>
            </div>
            <div class="ui-bar"><div class="ui-fill hype-fill" id="hypeBar" style="width: 30%"></div></div>

            <button class="pixel-button" onclick="game.hireEmployee()">üíº CONTRATAR</button>
            <button class="pixel-button" onclick="game.investMarketing()">üì¢ MARKETING</button>
            <button class="pixel-button" onclick="game.researchTech()">üî¨ R+D</button>
            <button class="pixel-button" onclick="game.moveOffice()">üè¢ MUDANZA</button>
        </div>

        <!-- RIGHT PANEL - EMPLOYEES -->
        <div class="ui-panel right" id="rightPanel">
            <div class="ui-title">üë• EQUIPO ACTIVO</div>
            <div id="employeeList"></div>
        </div>

        <!-- BOTTOM PANEL - ACTIONS -->
        <div class="ui-panel bottom" id="bottomPanel">
            <button class="pixel-button danger" onclick="game.toggleCrunch()" style="width: 150px;">
                üî• CRUNCH: <span id="crunchStatus">OFF</span>
            </button>
            <button class="pixel-button success" onclick="game.startNewProject()" style="width: 150px;">
                üéÆ NUEVO PROYECTO
            </button>
            <button class="pixel-button" onclick="game.continueProject()" style="width: 150px;" id="continueBtn">
                ‚öôÔ∏è CONTINUAR
            </button>
            <button class="pixel-button" onclick="game.takeContract()" style="width: 150px;">
                üìã CONTRATO
            </button>
        </div>
    </div>

    <!-- üéÆ MODAL: NEW GAME -->
    <div class="modal" id="newGameModal">
        <div class="modal-content">
            <div class="modal-title">üéÆ CREAR NUEVO JUEGO</div>
            
            <div class="modal-section">
                <h4>üé≤ G√âNERO</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="genre" data-value="accion" onclick="game.selectOption(this)">
                        <div class="option-icon">üéÆ</div>
                        <div>ACCI√ìN</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="rpg" onclick="game.selectOption(this)">
                        <div class="option-icon">‚öîÔ∏è</div>
                        <div>RPG</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="estrategia" onclick="game.selectOption(this)">
                        <div class="option-icon">üó∫Ô∏è</div>
                        <div>ESTRATEGIA</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="puzzle" onclick="game.selectOption(this)">
                        <div class="option-icon">üß©</div>
                        <div>PUZZLE</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="terror" onclick="game.selectOption(this)">
                        <div class="option-icon">üëª</div>
                        <div>TERROR</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="simulacion" onclick="game.selectOption(this)">
                        <div class="option-icon">üè≠</div>
                        <div>SIMULACI√ìN</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üé® TEMA</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="tema" data-value="espacial" onclick="game.selectOption(this)">
                        <div class="option-icon">üöÄ</div>
                        <div>ESPACIAL</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="medieval" onclick="game.selectOption(this)">
                        <div class="option-icon">üè∞</div>
                        <div>MEDIEVAL</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="cyberpunk" onclick="game.selectOption(this)">
                        <div class="option-icon">üåÜ</div>
                        <div>CYBERPUNK</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="fantasia" onclick="game.selectOption(this)">
                        <div class="option-icon">ü¶Ñ</div>
                        <div>FANTAS√çA</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="zombies" onclick="game.selectOption(this)">
                        <div class="option-icon">üßü</div>
                        <div>ZOMBIES</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="deportes" onclick="game.selectOption(this)">
                        <div class="option-icon">‚öΩ</div>
                        <div>DEPORTES</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üì∫ PLATAFORMA</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="plataforma" data-value="pc" onclick="game.selectOption(this)">
                        <div class="option-icon">üíª</div>
                        <div>PC</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="consola" onclick="game.selectOption(this)">
                        <div class="option-icon">üéÆ</div>
                        <div>CONSOLA</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="movil" onclick="game.selectOption(this)">
                        <div class="option-icon">üì±</div>
                        <div>M√ìVIL</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="vr" onclick="game.selectOption(this)">
                        <div class="option-icon">ü•Ω</div>
                        <div>VR</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üí∞ PRESUPUESTO</h4>
                <input type="range" id="budgetSlider" min="50000" max="500000" value="150000" 
                       oninput="game.updateBudget(this.value)" 
                       style="width: 100%; height: 10px; background: var(--bg-card); cursor: pointer;">
                <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 9px;">
                    <span>MIN: $50K</span>
                    <span id="budgetValue" style="color: var(--neon-blue); font-weight: 800;">$150K</span>
                    <span>MAX: $500K</span>
                </div>
            </div>

            <button class="pixel-button success" onclick="game.confirmProject()" style="margin-top: 15px;">‚úÖ INICIAR DESARROLLO</button>
        </div>
    </div>

    <!-- üéÆ REVIEW MODAL -->
    <div class="modal" id="reviewModal">
        <div class="modal-content review-modal">
            <div class="modal-title">üìä CR√çTICAS DE JUEGO</div>
            <div class="review-score" id="reviewScore">85</div>
            <div class="review-stars" id="reviewStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
            <div class="review-comments" id="reviewComments">Innovaci√≥n y ejecuci√≥n s√≥lida. Un prometedor inicio.</div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <div class="stat-box" style="flex: 1;">
                    <div class="stat-title">VENTAS</div>
                    <div class="stat-value" id="salesFigure">$450K</div>
                </div>
                <div class="stat-box" style="flex: 1;">
                    <div class="stat-title">UNIDADES</div>
                    <div class="stat-value" id="unitsSold">50K</div>
                </div>
            </div>
            <button class="pixel-button" onclick="game.closeReview()" style="margin-top: 15px;">CONTINUAR</button>
        </div>
    </div>

    <!-- üèÜ ACHIEVEMENT POPUP -->
    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-title" id="achievementTitle">¬°LOGRO DESBLOQUEADO!</div>
        <div class="achievement-desc" id="achievementDesc">Descripci√≥n del logro</div>
    </div>

    <!-- üì¢ NOTIFICATION -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notificationTitle">NOTIFICACI√ìN</div>
        <div class="notification-text" id="notificationText">Mensaje</div>
    </div>

    <!-- üíæ SAVE INDICATOR -->
    <div class="save-indicator" id="saveIndicator">üíæ GUARDANDO...</div>

    <script>
        // üéÆ MOTOR DE JUEGO COMPLETO
        class IndustryEvolutionSimulator {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gameState = {
                    a√±o: 2000,
                    mes: 1,
                    caja: 500000,
                    equipo: 15,
                    maxEquipo: 50,
                    reputacion: 65,
                    hype: 30,
                    moral: 75,
                    juegos: [],
                    proyectoActivo: null,
                    ingresosTotales: 0,
                    nivelEstudio: 1,
                    nivelInvestigacion: 1,
                    crunchMode: false,
                    descuentoContratacion: false,
                    empleados: this.generarEmpleadosIniciales()
                };

                this.teclado = { space: false };
                this.config = {
                    velocidadAnimacion: 0.05,
                    tamanoTile: 32,
                    escalaZoom: 1,
                    offsetX: 0,
                    offsetY: 0
                };

                this.sistemaParticulas = [];
                this.sistemaEventos = [];
                this.logros = {
                    primero: { nombre: "Debutante", descripcion: "Lanza tu primer juego", desbloqueado: false },
                    hit: { nombre: "Golpe de Suerte", descripcion: "Juego >85/100", desbloqueado: false },
                    experto: { nombre: "Productor Veterano", descripcion: "Lanza 10 juegos", desbloqueado: false },
                    millonario: { nombre: "Magnate", descripcion: "$1M en ingresos", desbloqueado: false }
                };

                this.baseDatos = {
                    generos: {
                        accion: { nombre: "Acci√≥n", base: 70, riesgo: 0.3, tendencia: [1,1,1,1,1,1.2,1.3,1.3,1.2,1.1] },
                        rpg: { nombre: "RPG", base: 80, riesgo: 0.5, tendencia: [1,1,1,1,1,1,1.1,1.1,1.2,1.4] },
                        estrategia: { nombre: "Estrategia", base: 75, riesgo: 0.4, tendencia: [1,1,1,1,1,1,1,1,1,1] },
                        puzzle: { nombre: "Puzzle", base: 65, riesgo: 0.2, tendencia: [0.8,0.8,0.9,1,1,1.1,1.2,1.3,1.4,1.5] },
                        terror: { nombre: "Terror", base: 85, riesgo: 0.6, tendencia: [1,1,1,1,1,1,1,1.1,1.2,1.3] },
                        simulacion: { nombre: "Simulaci√≥n", base: 60, riesgo: 0.3, tendencia: [1,1,1,1,1,1,1.1,1.1,1.2,1.3] }
                    },
                    temas: {
                        espacial: { nombre: "Espacial", multi: { accion: 1.2, simulacion: 1.3, rpg: 1.1 } },
                        medieval: { nombre: "Medieval", multi: { rpg: 1.4, estrategia: 1.3, accion: 1.1 } },
                        cyberpunk: { nombre: "Cyberpunk", multi: { rpg: 1.3, accion: 1.2, terror: 1.1 } },
                        fantasia: { nombre: "Fantas√≠a", multi: { rpg: 1.5, estrategia: 1.1, accion: 1 } },
                        zombies: { nombre: "Zombies", multi: { terror: 1.4, accion: 1.2, estrategia: 0.8 } },
                        deportes: { nombre: "Deportes", multi: { simulacion: 1.3, accion: 0.9, puzzle: 0.7 } }
                    },
                    plataformas: {
                        pc: { nombre: "PC", alcance: 1, costo: 1 },
                        consola: { nombre: "Consola", alcance: 1.2, costo: 1.3 },
                        movil: { nombre: "M√≥vil", alcance: 0.8, costo: 0.6 },
                        vr: { nombre: "VR", alcance: 0.3, costo: 1.8 }
                    }
                };

                this.eventosHistoria = {
                    2004: { tipo: 'danger', texto: 'üí• Caso EA Spouse expone crunch. Moral -20%', efecto: () => { this.gameState.moral = Math.max(0, this.gameState.moral - 20); } },
                    2008: { tipo: 'warning', texto: 'üìâ Crisis financiera. Mercado -30%', efecto: () => { /* Aplica multiplicador temporal */ } },
                    2012: { tipo: 'success', texto: 'üì± Boom mobile. Bonus +50% juegos m√≥viles', efecto: () => { this.gameState.hype += 30; } },
                    2017: { tipo: 'danger', texto: 'üé∞ Controversia loot boxes. Riesgo +15%', efecto: () => { this.gameState.reputacion = Math.max(0, this.gameState.reputacion - 15); } },
                    2020: { tipo: 'success', texto: 'üè† Pandemia +200% ventas digitales', efecto: () => { const bonus = 200000; this.gameState.caja += bonus; this.gameState.ingresosTotales += bonus; } },
                    2023: { tipo: 'warning', texto: 'üî• Despidos masivos. Talento -50% coste', efecto: () => { this.gameState.descuentoContratacion = true; } }
                };

                this.inicializar();
            }

            inicializar() {
                this.configurarCanvas();
                this.configurarEventos();
                this.iniciarLoop();
                this.mostrarNotificacion('üéÆ BIENVENIDO', 'Usa ESPACIO para acelerar desarrollo');
            }

            configurarCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                window.addEventListener('resize', () => {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                });
            }

            configurarEventos() {
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') this.teclado.space = true;
                });
                document.addEventListener('keyup', (e) => {
                    if (e.code === 'Space') this.teclado.space = false;
                });

                // Auto-save
                setInterval(() => this.guardarJuego(), 60000);
            }

            // üéÆ LOOP PRINCIPAL
            iniciarLoop() {
                let ultimoTiempo = 0;
                const loop = (timestamp) => {
                    const deltaTime = timestamp - ultimoTiempo;
                    ultimoTiempo = timestamp;

                    this.actualizar(deltaTime);
                    this.renderizar();

                    if (this.teclado.space && this.gameState.proyectoActivo) {
                        this.continuarProyecto();
                    }

                    requestAnimationFrame(loop);
                };
                requestAnimationFrame(loop);
            }

            actualizar(deltaTime) {
                // Actualizar empleados
                this.gameState.empleados.forEach(empleado => empleado.actualizar(deltaTime));

                // Actualizar part√≠culas
                this.sistemaParticulas = this.sistemaParticulas.filter(p => p.actualizar(deltaTime));

                // Actualizar eventos
                this.sistemaEventos = this.sistemaEventos.filter(e => e.actualizar(deltaTime));

                // Check historical events
                if (this.gameState.mes === 1 && this.eventosHistoria[this.gameState.a√±o]) {
                    const evento = this.eventosHistoria[this.gameState.a√±o];
                    this.agregarEvento(evento.tipo, evento.texto);
                    evento.efecto();
                }
            }

            renderizar() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Dibujar oficina isom√©trica
                this.dibujarOficina();

                // Dibujar empleados
                this.gameState.empleados.forEach(empleado => empleado.dibujar(this.ctx));

                // Dibujar part√≠culas
                this.sistemaParticulas.forEach(p => p.dibujar(this.ctx));

                // Dibujar UI overlay
                this.dibujarUI();
            }

            dibujarOficina() {
                const ctx = this.ctx;
                const tile = this.config.tamanoTile;
                const offsetX = this.config.offsetX;
                const offsetY = this.config.offsetY;

                // Grid isom√©trico
                ctx.strokeStyle = 'rgba(100,100,100,0.1)';
                ctx.lineWidth = 1;

                for (let x = 0; x < 50; x++) {
                    for (let y = 0; y < 50; y++) {
                        const isoX = (x - y) * tile / 2 + offsetX;
                        const isoY = (x + y) * tile / 4 + offsetY;
                        
                        ctx.strokeRect(isoX, isoY, tile, tile / 2);
                    }
                }

                // Muebles y workstations
                ctx.fillStyle = '#444';
                for (let i = 0; i < Math.min(this.gameState.equipo, 20); i++) {
                    const x = i % 5;
                    const y = Math.floor(i / 5);
                    const isoX = (x - y) * tile / 2 + offsetX + 200;
                    const isoY = (x + y) * tile / 4 + offsetY + 100;
                    
                    ctx.fillRect(isoX, isoY, tile * 0.8, tile * 0.4);
                    ctx.fillStyle = '#222';
                    ctx.fillRect(isoX + 5, isoY - 10, tile * 0.6, tile * 0.2);
                    ctx.fillStyle = '#444';
                }
            }

            dibujarUI() {
                // Update UI values
                document.getElementById('uiCash').textContent = `$${(this.gameState.caja / 1000).toFixed(0)}K`;
                document.getElementById('uiTeam').textContent = `${this.gameState.equipo} / ${this.gameState.maxEquipo}`;
                document.getElementById('uiRep').textContent = `${this.gameState.reputacion}%`;
                document.getElementById('uiHype').textContent = `${this.gameState.hype}%`;
                
                document.getElementById('cashBar').style.width = `${Math.min(100, this.gameState.caja / 10000)}%`;
                document.getElementById('teamBar').style.width = `${(this.gameState.equipo / this.gameState.maxEquipo) * 100}%`;
                document.getElementById('repBar').style.width = `${this.gameState.reputacion}%`;
                document.getElementById('hypeBar').style.width = `${this.gameState.hype}%`;

                // Update employee list
                this.actualizarListaEmpleados();
            }

            actualizarListaEmpleados() {
                const container = document.getElementById('employeeList');
                container.innerHTML = '';
                
                this.gameState.empleados.slice(0, 5).forEach(empleado => {
                    const div = document.createElement('div');
                    div.className = 'ui-stat';
                    div.style.fontSize = '9px';
                    div.innerHTML = `
                        <span>${empleado.nombre}</span>
                        <span style="color: ${empleado.moral > 60 ? '#00ff41' : '#ffcc00'}">${empleado.moral}%</span>
                    `;
                    container.appendChild(div);
                });
            }

            // üéÆ MEC√ÅNICAS DE JUEGO
            generarEmpleadosIniciales() {
                const nombres = ['Alex', 'Sam', 'Jordan', 'Taylor', 'Morgan', 'Casey', 'Riley', 'Avery'];
                const apellidos = ['Dev', 'Coder', 'Designer', 'Artist', 'Tester', 'Producer'];
                const empleados = [];
                
                for (let i = 0; i < 3; i++) {
                    empleados.push(new Empleado(
                        nombres[Math.floor(Math.random() * nombres.length)] + ' ' + apellidos[Math.floor(Math.random() * apellidos.length)],
                        100 + i * 150,
                        200 + i * 50,
                        this
                    ));
                }
                return empleados;
            }

            contratarEmpleado() {
                const costo = this.gameState.descuentoContratacion ? 25000 : 50000;
                if (this.gameState.caja >= costo && this.gameState.equipo < this.gameState.maxEquipo) {
                    this.gameState.caja -= costo;
                    this.gameState.equipo++;
                    
                    const nombres = ['Alex', 'Sam', 'Jordan', 'Taylor', 'Morgan', 'Casey', 'Riley', 'Avery'];
                    const apellidos = ['Dev', 'Coder', 'Designer', 'Artist', 'Tester', 'Producer'];
                    const emp = new Empleado(
                        nombres[Math.floor(Math.random() * nombres.length)] + ' ' + apellidos[Math.floor(Math.random() * apellidos.length)],
                        200 + Math.random() * 400,
                        150 + Math.random() * 200,
                        this
                    );
                    this.gameState.empleados.push(emp);
                    
                    this.gameState.moral = Math.min(100, this.gameState.moral + 5);
                    this.mostrarNotificacion('üíº CONTRATADO', 'Nuevo miembro en el equipo');
                    this.agregarEvento('success', `Contratado: ${emp.nombre}`);
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', this.gameState.equipo >= this.gameState.maxEquipo ? 'Equipo al m√°ximo' : 'Caja insuficiente');
                }
            }

            invertirMarketing() {
                const costo = 30000;
                if (this.gameState.caja >= costo) {
                    this.gameState.caja -= costo;
                    this.gameState.hype = Math.min(100, this.gameState.hype + 25);
                    this.mostrarNotificacion('üì¢ MARKETING', 'Campa√±a aumenta hype +25');
                    this.agregarEvento('info', 'Campa√±a de marketing lanzada');
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', 'Caja insuficiente');
                }
            }

            investigarTecnologia() {
                const costo = 75000;
                if (this.gameState.caja >= costo) {
                    this.gameState.caja -= costo;
                    this.gameState.nivelInvestigacion++;
                    this.mostrarNotificacion('üî¨ INVESTIGACI√ìN', `Nivel ${this.gameState.nivelInvestigacion} desbloqueado`);
                    this.agregarEvento('success', 'Investigaci√≥n completada');
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', 'Caja insuficiente');
                }
            }

            mudarOficina() {
                const costo = 150000;
                if (this.gameState.caja >= costo && this.gameState.nivelEstudio < 5) {
                    this.gameState.caja -= costo;
                    this.gameState.nivelEstudio++;
                    this.gameState.maxEquipo += 25;
                    this.gameState.moral = Math.min(100, this.gameState.moral + 20);
                    this.mostrarNotificacion('üè¢ MUDANZA', `Oficina nivel ${this.gameState.nivelEstudio} activa`);
                    this.agregarEvento('success', `Oficina mejorada: +25 equipo m√°ximo`);
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', this.gameState.nivelEstudio >= 5 ? 'M√°ximo nivel' : 'Caja insuficiente');
                }
            }

            alternarCrunch() {
                this.gameState.crunchMode = !this.gameState.crunchMode;
                document.getElementById('crunchStatus').textContent = this.gameState.crunchMode ? 'ON' : 'OFF';
                this.mostrarNotificacion('üî• CRUNCH', this.gameState.crunchMode ? 'Activado: +velocidad, -moral' : 'Desactivado');
                this.agregarEvento('warning', `Crunch mode ${this.gameState.crunchMode ? 'ACTIVADO' : 'DESACTIVADO'}`);
            }

            trabajoContrato() {
                const ingresos = 40000;
                this.gameState.caja += ingresos;
                this.gameState.ingresosTotales += ingresos;
                this.mostrarNotificacion('üìã CONTRATO', `+${ingresos / 1000}K de ingresos seguros`);
                this.agregarEvento('info', 'Trabajo por contrato completado');
                this.actualizarUI();
            }

            construccionEquipo() {
                const costo = 20000;
                if (this.gameState.caja >= costo) {
                    this.gameState.caja -= costo;
                    this.gameState.moral = Math.min(100, this.gameState.moral + 15);
                    this.mostrarNotificacion('üèñÔ∏è RETIRO', 'Moral de equipo +15');
                    this.agregarEvento('success', 'Evento de team building completado');
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', 'Caja insuficiente');
                }
            }

            investigacionAI() {
                this.mostrarNotificacion('üîí PR√ìXIMAMENTE', 'Feature en desarrollo');
            }

            patentarTecnologia() {
                this.mostrarNotificacion('üîí PR√ìXIMAMENTE', 'Feature en desarrollo');
            }

            // üéÆ PROYECTO
            iniciarNuevoProyecto() {
                if (this.gameState.proyectoActivo) {
                    this.mostrarNotificacion('‚ö†Ô∏è PROYECTO ACTIVO', 'Termina el juego actual primero');
                    return;
                }
                document.getElementById('newGameModal').classList.add('active');
            }

            continuarProyecto() {
                if (!this.gameState.proyectoActivo) return;
                document.getElementById('continueBtn').classList.add('bouncing');
                setTimeout(() => document.getElementById('continueBtn').classList.remove('bouncing'), 300);
                this.desarrollarProyecto();
            }

            desarrollarProyecto() {
                const proyecto = this.gameState.proyectoActivo;
                if (!proyecto) return;

                const velocidad = this.gameState.crunchMode ? 25 : 15;
                const penalidad = this.gameState.crunchMode ? 5 : 0;

                proyecto.progreso += velocidad;
                this.gameState.moral = Math.max(0, this.gameState.moral - penalidad);

                // Eventos random durante desarrollo
                if (Math.random() < 0.05) this.eventoDesarrolloRandom();

                // Finalizar proyecto
                if (proyecto.progreso >= 100) {
                    this.lanzarJuego();
                }

                // Actualizar UI
                document.getElementById('projectProgress').textContent = `${proyecto.progreso}%`;
                document.getElementById('progressBar').style.width = `${proyecto.progreso}%`;

                this.actualizarUI();
            }

            eventoDesarrolloRandom() {
                const eventos = [
                    { tipo: 'warning', texto: 'üêõ ¬°Bug cr√≠tico! -10% progreso', efecto: () => { this.gameState.proyectoActivo.progreso -= 10; } },
                    { tipo: 'success', texto: '‚≠ê ¬°Estrella del equipo! +15% progreso', efecto: () => { this.gameState.proyectoActivo.progreso += 15; } },
                    { tipo: 'info', texto: 'üí° ¬°Inspiraci√≥n! +5 calidad', efecto: () => { this.gameState.proyectoActivo.calidad += 5; } }
                ];
                const evento = eventos[Math.floor(Math.random() * eventos.length)];
                evento.efecto();
                this.agregarEvento(evento.tipo, evento.texto);
            }

            lanzarJuego() {
                const proyecto = this.gameState.proyectoActivo;
                const nota = this.calcularNotaFinal(proyecto);
                const ventas = this.calcularVentas(proyecto, nota);

                // Actualizar estado
                this.gameState.caja += ventas;
                this.gameState.ingresosTotales += ventas;
                this.gameState.juegos.push({...proyecto, nota, ventas, a√±o: this.gameState.a√±o});

                // Actualizar reputaci√≥n y moral
                const cambioRep = nota > 80 ? 8 : nota > 60 ? 3 : -5;
                this.gameState.reputacion = Math.max(0, Math.min(100, this.gameState.reputacion + cambioRep));
                this.gameState.hype = Math.max(10, this.gameState.hype - 30);
                this.gameState.moral = Math.min(100, this.gameState.moral + 10);

                // Limpiar proyecto
                this.gameState.proyectoActivo = null;
                document.getElementById('activeProject').style.display = 'none';
                document.getElementById('newGameBtn').style.display = 'block';
                document.getElementById('continueBtn').style.display = 'none';

                // Mostrar review
                this.mostrarReview(nota, ventas);

                // Eventos post-lanzamiento
                if (nota > 80 && Math.random() < 0.3) this.eventoPostLanzamiento(proyecto, ventas);

                this.agregarEvento(nota > 80 ? 'success' : nota > 60 ? 'info' : 'danger',
                    `üéÆ ${this.baseDatos.generos[proyecto.genero].nombre} lanzado: ${nota.toFixed(1)}/100`);
                
                this.comprobarLogros();
                this.actualizarUI();
            }

            calcularNotaFinal(proyecto) {
                const genero = this.baseDatos.generos[proyecto.genero];
                const tema = this.baseDatos.temas[proyecto.tema];
                const plataforma = this.baseDatos.plataformas[proyecto.plataforma];
                
                const a√±oIndex = Math.min(9, Math.floor((this.gameState.a√±o - 2000) / 3));
                const tendencia = genero.tendencia[a√±oIndex];
                
                let nota = genero.base * tendencia;
                nota *= (tema.multi[proyecto.genero] || 1);
                nota *= (proyecto.presupuesto / 100000) * 0.5 + 0.5;
                nota *= (this.gameState.reputacion / 100);
                nota *= (this.gameState.moral / 100) * 0.5 + 0.5;
                nota *= (this.gameState.equipo / 30) * 0.3 + 0.7;
                nota *= 0.8 + Math.random() * 0.4;

                return Math.min(100, Math.max(0, nota));
            }

            calcularVentas(proyecto, nota) {
                const base = proyecto.presupuesto * 3;
                const bonusNota = (nota - 50) / 50;
                const bonusHype = this.gameState.hype / 100;
                const a√±oMulti = this.gameState.a√±o < 2010 ? 0.8 : this.gameState.a√±o < 2020 ? 1.0 : 1.2;
                return Math.floor(base * (1 + bonusNota) * (1 + bonusHype) * a√±oMulti);
            }

            eventoPostLanzamiento(proyecto, ventas) {
                // DLC
                if (Math.random() < 0.3) {
                    const dlc = ventas * 0.2;
                    this.gameState.caja += dlc;
                    this.gameState.ingresosTotales += dlc;
                    this.agregarEvento('success', `üì¶ DLC genera +$${(dlc/1000).toFixed(0)}K`);
                }
                // Premios
                if (Math.random() < 0.1) {
                    const premio = 50000;
                    this.gameState.caja += premio;
                    this.gameState.reputacion = Math.min(100, this.gameState.reputacion + 10);
                    this.agregarEvento('success', `üèÜ ¬°Game of the Year! +$50K`);
                }
            }

            mostrarReview(nota, ventas) {
                document.getElementById('reviewScore').textContent = nota.toFixed(0);
                document.getElementById('reviewStars').textContent = '‚òÖ'.repeat(Math.floor(nota / 20)) + '‚òÜ'.repeat(5 - Math.floor(nota / 20));
                document.getElementById('salesFigure').textContent = `$${(ventas / 1000).toFixed(0)}K`;
                document.getElementById('unitsSold').textContent = `${(ventas / 10).toFixed(0)}K`;
                
                const comentarios = nota >= 90 ? "¬°Obra maestra! Game of the Year." :
                                  nota >= 80 ? "¬°Excelente! Compra obligatoria." :
                                  nota >= 70 ? "Buen juego con peque√±os fallos." :
                                  nota >= 60 ? "Experiencia promedio." :
                                  "Decepcionante. Necesita mejora.";
                document.getElementById('reviewComments').textContent = comentarios;
                
                document.getElementById('reviewModal').classList.add('active');
            }

            cerrarReview() {
                document.getElementById('reviewModal').classList.remove('active');
            }

            // üéÆ UTILIDADES
            actualizarUI() {
                document.getElementById('uiCash').textContent = `$${(this.gameState.caja / 1000).toFixed(0)}K`;
                document.getElementById('uiTeam').textContent = `${this.gameState.equipo} / ${this.gameState.maxEquipo}`;
                document.getElementById('uiRep').textContent = `${this.gameState.reputacion}%`;
                document.getElementById('uiHype').textContent = `${this.gameState.hype}%`;
                
                document.getElementById('cashBar').style.width = `${Math.min(100, this.gameState.caja / 10000)}%`;
                document.getElementById('teamBar').style.width = `${(this.gameState.equipo / this.gameState.maxEquipo) * 100}%`;
                document.getElementById('repBar').style.width = `${this.gameState.reputacion}%`;
                document.getElementById('hypeBar').style.width = `${this.gameState.hype}%`;
                
                // Actualizar proyecto activo
                if (this.gameState.proyectoActivo) {
                    document.getElementById('activeProject').style.display = 'block';
                    document.getElementById('newGameBtn').style.display = 'none';
                    document.getElementById('continueBtn').style.display = 'block';
                    document.getElementById('projectName').textContent = 
                        `${this.baseDatos.generos[this.gameState.proyectoActivo.genero].nombre}`;
                    document.getElementById('projectProgress').textContent = `${this.gameState.proyectoActivo.progreso}%`;
                    document.getElementById('progressBar').style.width = `${this.gameState.proyectoActivo.progreso}%`;
                } else {
                    document.getElementById('activeProject').style.display = 'none';
                    document.getElementById('newGameBtn').style.display = 'block';
                    document.getElementById('continueBtn').style.display = 'none';
                }

                this.comprobarLogros();
            }

            comprobarLogros() {
                if (this.gameState.juegos.length === 1 && !this.logros.primero.desbloqueado) {
                    this.desbloquearLogro(this.logros.primero);
                }
                if (this.gameState.juegos.length >= 10 && !this.logros.experto.desbloqueado) {
                    this.desbloquearLogro(this.logros.experto);
                }
                if (this.gameState.ingresosTotales >= 1000000 && !this.logros.millonario.desbloqueado) {
                    this.desbloquearLogro(this.logros.millonario);
                }
                const hit = this.gameState.juegos.find(j => j.nota >= 85);
                if (hit && !this.logros.hit.desbloqueado) {
                    this.desbloquearLogro(this.logros.hit);
                }
            }

            desbloquearLogro(logro) {
                logro.desbloqueado = true;
                document.getElementById('achievementTitle').textContent = `üèÜ ${logro.nombre}`;
                document.getElementById('achievementDesc').textContent = logro.descripcion;
                document.getElementById('achievementPopup').classList.add('active');
                setTimeout(() => document.getElementById('achievementPopup').classList.remove('active'), 4000);
                this.agregarEvento('success', `¬°Logro desbloqueado: ${logro.nombre}!`);
            }

            agregarEvento(tipo, texto) {
                const log = document.getElementById('eventLog');
                const evento = document.createElement('div');
                evento.className = `event-item ${tipo}`;
                evento.innerHTML = `<div class="event-header">${this.gameState.a√±o}-${this.gameState.mes.toString().padStart(2, '0')}</div>${texto}`;
                log.insertBefore(evento, log.firstChild);
                while (log.children.length > 10) log.removeChild(log.lastChild);
            }

            mostrarNotificacion(titulo, texto) {
                document.getElementById('notificationTitle').textContent = titulo;
                document.getElementById('notificationText').textContent = texto;
                const notif = document.getElementById('notification');
                notif.classList.add('show');
                setTimeout(() => notif.classList.remove('show'), 4000);
            }

            guardarJuego() {
                localStorage.setItem('industrySimGOTY', JSON.stringify(this.gameState));
                document.getElementById('saveIndicator').classList.add('show');
                setTimeout(() => document.getElementById('saveIndicator').classList.remove('show'), 1000);
            }

            cargarJuego() {
                const guardado = localStorage.getItem('industrySimGOTY');
                if (guardado) {
                    Object.assign(this.gameState, JSON.parse(guardado));
                    this.gameState.empleados = this.gameState.empleados.map(e => Object.assign(new Empleado('', 0, 0, this), e));
                    this.actualizarUI();
                    this.mostrarNotificacion('üìÇ PARTIDA CARGADA', 'Contin√∫a desde tu √∫ltimo guardado');
                }
            }

            actualizarBudget(valor) {
                document.getElementById('budgetValue').textContent = `$${(valor / 1000).toFixed(0)}K`;
            }

            selectOption(element) {
                const type = element.dataset.type;
                document.querySelectorAll(`[data-type="${type}"]`).forEach(el => el.classList.remove('selected'));
                element.classList.add('selected');
            }

            confirmProject() {
                const genero = document.querySelector('[data-type="genero"].selected')?.dataset.value;
                const tema = document.querySelector('[data-type="tema"].selected')?.dataset.value;
                const plataforma = document.querySelector('[data-type="plataforma"].selected')?.dataset.value;
                const presupuesto = parseInt(document.getElementById('budgetSlider').value);

                if (!genero || !tema || !plataforma) {
                    this.mostrarNotificacion('‚ùå ERROR', 'Selecciona todas las opciones');
                    return;
                }

                if (this.gameState.caja < presupuesto) {
                    this.mostrarNotificacion('‚ùå ERROR', `Necesitas $${presupuesto.toLocaleString()}`);
                    return;
                }

                this.gameState.caja -= presupuesto;
                this.gameState.proyectoActivo = {
                    genero, tema, plataforma, presupuesto,
                    progreso: 0, calidad: 0,
                    notaEsperada: this.calcularNotaEsperada(genero, tema, plataforma, presupuesto)
                };

                document.getElementById('newGameModal').classList.remove('active');
                document.querySelectorAll('.option-tile').forEach(el => el.classList.remove('selected'));
                
                this.mostrarNotificacion('üéÆ PROYECTO INICIADO', `${this.baseDatos.generos[genero].nombre}`);
                this.actualizarUI();
            }

            calcularNotaEsperada(genero, tema, plataforma, presupuesto) {
                const gen = this.baseDatos.generos[genero];
                const tem = this.baseDatos.temas[tema];
                const plat = this.baseDatos.plataformas[plataforma];
                
                const a√±oIndex = Math.min(9, Math.floor((this.gameState.a√±o - 2000) / 3));
                const tendencia = gen.tendencia[a√±oIndex];
                
                return gen.base * tendencia * (tem.multi[genero] || 1) * (presupuesto / 100000) * (this.gameState.reputacion / 100);
            }

            closeReview() {
                document.getElementById('reviewModal').classList.remove('active');
            }
        }

        // üéÆ CLASE EMPLEADO
        class Empleado {
            constructor(nombre, x, y, juego) {
                this.nombre = nombre;
                this.x = x;
                this.y = y;
                this.juego = juego;
                this.moral = 75;
                this.habilidad = Math.random() * 0.5 + 0.5;
                this.estado = 'idle'; // idle, walk, work, celebrate, stress
                this.frame = 0;
                this.velocidad = 2;
                this.destinoX = x;
                this.destinoY = y;
                this.color = `hsl(${Math.random() * 360}, 70%, 50%)`;
            }

            actualizar(deltaTime) {
                this.frame += deltaTime * 0.01;

                // Movimiento hacia destino
                if (this.estado === 'walk') {
                    const dx = this.destinoX - this.x;
                    const dy = this.destinoY - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist > 5) {
                        this.x += (dx / dist) * this.velocidad;
                        this.y += (dy / dist) * this.velocidad;
                    } else {
                        this.estado = 'idle';
                    }
                }

                // Cambiar estado basado en moral y crunch
                if (this.juego.gameState.crunchMode && this.moral < 40) {
                    this.estado = 'stress';
                } else if (this.juego.gameState.proyectoActivo && this.moral > 60) {
                    this.estado = 'work';
                } else if (Math.random() < 0.001) {
                    this.caminarAleatorio();
                }
            }

            dibujar(ctx) {
                const size = 16;
                const x = this.x - size / 2;
                const y = this.y - size / 2;

                // Cuerpo
                ctx.fillStyle = this.color;
                ctx.fillRect(x, y, size, size);

                // Cabeza
                ctx.fillStyle = '#fdbcb4';
                ctx.fillRect(x + 4, y - 8, 8, 8);

                // Estado visual
                if (this.estado === 'stress') {
                    ctx.fillStyle = 'rgba(255, 0, 64, 0.5)';
                    ctx.fillRect(x, y, size, size);
                } else if (this.estado === 'work') {
                    ctx.fillStyle = 'rgba(0, 184, 255, 0.3)';
                    ctx.fillRect(x - 2, y - 2, size + 4, size + 4);
                }

                // Nombre
                ctx.fillStyle = '#ffffff';
                ctx.font = '8px Pixelify Sans';
                ctx.fillText(this.nombre.split(' ')[0], x - 10, y + size + 10);
            }

            caminarAleatorio() {
                const tile = this.juego.config.tamanoTile;
                this.destinoX = 200 + Math.random() * 400;
                this.destinoY = 150 + Math.random() * 200;
                this.estado = 'walk';
            }

            celebrar() {
                this.estado = 'celebrate';
                this.moral = Math.min(100, this.moral + 10);
                setTimeout(() => this.estado = 'idle', 3000);
            }
        }

        // üéÆ INICIAR JUEGO
        window.addEventListener('load', () => {
            window.game = new IndustryEvolutionSimulator();
            window.game.cargarJuego();
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industry Evolution Simulator - GOTY Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Pixelify+Sans:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-panel: #2a2a2a;
            --bg-card: #3a3a3a;
            --bg-card-hover: #4a4a4a;
            --neon-green: #00ff41;
            --neon-blue: #00b8ff;
            --neon-yellow: #ffcc00;
            --neon-red: #ff0040;
            --neon-purple: #b967ff;
            --pixel-border: #555555;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
        }

        body {
            font-family: 'Pixelify Sans', monospace;
            background: radial-gradient(ellipse at center, #1a0033 0%, var(--bg-primary) 100%);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        /* üéÆ PIXEL PERFECT RENDERING */
        canvas {
            display: block;
            background: var(--bg-secondary);
            border: 3px solid var(--pixel-border);
            box-shadow: 0 0 20px rgba(0, 184, 255, 0.3);
        }

        /* üìä UI OVERLAY */
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .ui-panel {
            position: absolute;
            background: rgba(26, 26, 26, 0.95);
            border: 3px solid var(--pixel-border);
            padding: 10px;
            pointer-events: all;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ui-panel.hidden {
            transform: translateX(-100%);
        }

        .ui-panel.right {
            right: 0;
        }

        .ui-panel.bottom {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .ui-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            color: var(--neon-blue);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 8px var(--neon-blue);
        }

        .ui-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 10px;
        }

        .ui-stat-label {
            color: var(--text-secondary);
        }

        .ui-stat-value {
            color: var(--neon-green);
            font-weight: 700;
        }

        .ui-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-panel);
            border: 1px solid var(--pixel-border);
            position: relative;
            margin-top: 4px;
            overflow: hidden;
        }

        .ui-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .cash-fill { background: linear-gradient(90deg, var(--neon-green), #00cc33); }
        .team-fill { background: linear-gradient(90deg, var(--neon-blue), #0088cc); }
        .rep-fill { background: linear-gradient(90deg, var(--neon-yellow), #cc9900); }
        .hype-fill { background: linear-gradient(90deg, var(--neon-purple), #9966cc); }

        /* üéÆ BUTTONS */
        .pixel-button {
            font-family: 'Pixelify Sans', monospace;
            font-size: 10px;
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            color: var(--text-primary);
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.15s;
            display: block;
            width: 100%;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .pixel-button:hover {
            background: var(--neon-blue);
            color: var(--bg-dark);
            border-color: var(--neon-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 184, 255, 0.3);
        }

        .pixel-button:active {
            transform: scale(0.95);
        }

        .pixel-button.danger {
            border-color: var(--neon-red);
        }

        .pixel-button.danger:hover {
            background: var(--neon-red);
        }

        .pixel-button.success {
            border-color: var(--neon-green);
        }

        .pixel-button.success:hover {
            background: var(--neon-green);
        }

        /* üéÆ MODAL */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            place-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: grid;
        }

        .modal-content {
            background: var(--bg-panel);
            border: 4px solid var(--pixel-blue);
            padding: 20px;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalPop 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-title {
            font-size: 14px;
            color: var(--neon-blue);
            margin-bottom: 15px;
            text-align: center;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .option-tile {
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-size: 9px;
        }

        .option-tile:hover {
            border-color: var(--neon-blue);
            transform: scale(1.05);
        }

        .option-tile.selected {
            border-color: var(--neon-green);
            background: rgba(0, 255, 65, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
        }

        .option-icon {
            font-size: 16px;
            margin-bottom: 4px;
        }

        /* üéÆ REVIEW MODAL */
        .review-modal .review-score {
            font-size: 48px;
            font-weight: 900;
            color: var(--neon-green);
            text-shadow: 3px 3px 0 var(--bg-dark);
            text-align: center;
            margin: 20px 0;
        }

        .review-modal .review-stars {
            font-size: 24px;
            color: var(--neon-yellow);
            text-align: center;
            margin-bottom: 15px;
        }

        .review-modal .review-comments {
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            padding: 12px;
            font-size: 10px;
            line-height: 1.4;
            margin: 15px 0;
        }

        /* üéÆ ACHIEVEMENT */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, var(--neon-purple), var(--neon-pink));
            border: 4px solid var(--neon-yellow);
            padding: 20px 30px;
            z-index: 2000;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-align: center;
        }

        .achievement-popup.active {
            transform: translate(-50%, -50%) scale(1);
        }

        .achievement-title {
            font-size: 14px;
            font-weight: 900;
            margin-bottom: 5px;
            color: var(--bg-dark);
        }

        .achievement-desc {
            font-size: 10px;
            color: var(--text-primary);
        }

        /* üéÆ NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            right: -400px;
            background: var(--bg-panel);
            border: 2px solid var(--neon-blue);
            padding: 10px 15px;
            max-width: 300px;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1500;
        }

        .notification.show {
            right: 20px;
        }

        .notification-title {
            color: var(--neon-blue);
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 10px;
        }

        .notification-text {
            font-size: 9px;
            color: var(--text-secondary);
        }

        /* üéÆ ANIMATIONS */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .bouncing {
            animation: bounce 0.3s ease-in-out;
        }

        /* üéÆ RESPONSIVE */
        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: 200px 1fr 150px;
            }
            
            .ui-panel.left, .ui-panel.right {
                position: relative;
                width: 100%;
                height: 100%;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="1920" height="1080"></canvas>

    <!-- üéÆ UI OVERLAY -->
    <div class="ui-overlay">
        <!-- LEFT PANEL - RESOURCES -->
        <div class="ui-panel left" id="leftPanel">
            <div class="ui-title">üìä STUDIO RESOURCES</div>
            
            <div class="ui-stat">
                <span class="ui-stat-label">üí∞ CASH</span>
                <span class="ui-stat-value" id="uiCash">$500K</span>
            </div>
            <div class="ui-bar"><div class="ui-fill cash-fill" id="cashBar" style="width: 50%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">üë• TEAM</span>
                <span class="ui-stat-value" id="uiTeam">15 / 50</span>
            </div>
            <div class="ui-bar"><div class="ui-fill team-fill" id="teamBar" style="width: 30%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">‚≠ê REPUTATION</span>
                <span class="ui-stat-value" id="uiRep">65%</span>
            </div>
            <div class="ui-bar"><div class="ui-fill rep-fill" id="repBar" style="width: 65%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">üî• HYPE</span>
                <span class="ui-stat-value" id="uiHype">30%</span>
            </div>
            <div class="ui-bar"><div class="ui-fill hype-fill" id="hypeBar" style="width: 30%"></div></div>

            <button class="pixel-button" onclick="game.hireEmployee()">üíº CONTRATAR</button>
            <button class="pixel-button" onclick="game.investMarketing()">üì¢ MARKETING</button>
            <button class="pixel-button" onclick="game.researchTech()">üî¨ R+D</button>
            <button class="pixel-button" onclick="game.moveOffice()">üè¢ MUDANZA</button>
        </div>

        <!-- RIGHT PANEL - EMPLOYEES -->
        <div class="ui-panel right" id="rightPanel">
            <div class="ui-title">üë• EQUIPO ACTIVO</div>
            <div id="employeeList"></div>
        </div>

        <!-- BOTTOM PANEL - ACTIONS -->
        <div class="ui-panel bottom" id="bottomPanel">
            <button class="pixel-button danger" onclick="game.toggleCrunch()" style="width: 150px;">
                üî• CRUNCH: <span id="crunchStatus">OFF</span>
            </button>
            <button class="pixel-button success" onclick="game.startNewProject()" style="width: 150px;">
                üéÆ NUEVO PROYECTO
            </button>
            <button class="pixel-button" onclick="game.continueProject()" style="width: 150px;" id="continueBtn">
                ‚öôÔ∏è CONTINUAR
            </button>
            <button class="pixel-button" onclick="game.takeContract()" style="width: 150px;">
                üìã CONTRATO
            </button>
        </div>
    </div>

    <!-- üéÆ MODAL: NEW GAME -->
    <div class="modal" id="newGameModal">
        <div class="modal-content">
            <div class="modal-title">üéÆ CREAR NUEVO JUEGO</div>
            
            <div class="modal-section">
                <h4>üé≤ G√âNERO</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="genre" data-value="accion" onclick="game.selectOption(this)">
                        <div class="option-icon">üéÆ</div>
                        <div>ACCI√ìN</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="rpg" onclick="game.selectOption(this)">
                        <div class="option-icon">‚öîÔ∏è</div>
                        <div>RPG</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="estrategia" onclick="game.selectOption(this)">
                        <div class="option-icon">üó∫Ô∏è</div>
                        <div>ESTRATEGIA</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="puzzle" onclick="game.selectOption(this)">
                        <div class="option-icon">üß©</div>
                        <div>PUZZLE</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="terror" onclick="game.selectOption(this)">
                        <div class="option-icon">üëª</div>
                        <div>TERROR</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="simulacion" onclick="game.selectOption(this)">
                        <div class="option-icon">üè≠</div>
                        <div>SIMULACI√ìN</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üé® TEMA</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="tema" data-value="espacial" onclick="game.selectOption(this)">
                        <div class="option-icon">üöÄ</div>
                        <div>ESPACIAL</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="medieval" onclick="game.selectOption(this)">
                        <div class="option-icon">üè∞</div>
                        <div>MEDIEVAL</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="cyberpunk" onclick="game.selectOption(this)">
                        <div class="option-icon">üåÜ</div>
                        <div>CYBERPUNK</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="fantasia" onclick="game.selectOption(this)">
                        <div class="option-icon">ü¶Ñ</div>
                        <div>FANTAS√çA</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="zombies" onclick="game.selectOption(this)">
                        <div class="option-icon">üßü</div>
                        <div>ZOMBIES</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="deportes" onclick="game.selectOption(this)">
                        <div class="option-icon">‚öΩ</div>
                        <div>DEPORTES</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üì∫ PLATAFORMA</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="plataforma" data-value="pc" onclick="game.selectOption(this)">
                        <div class="option-icon">üíª</div>
                        <div>PC</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="consola" onclick="game.selectOption(this)">
                        <div class="option-icon">üéÆ</div>
                        <div>CONSOLA</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="movil" onclick="game.selectOption(this)">
                        <div class="option-icon">üì±</div>
                        <div>M√ìVIL</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="vr" onclick="game.selectOption(this)">
                        <div class="option-icon">ü•Ω</div>
                        <div>VR</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üí∞ PRESUPUESTO</h4>
                <input type="range" id="budgetSlider" min="50000" max="500000" value="150000" 
                       oninput="game.updateBudget(this.value)" 
                       style="width: 100%; height: 10px; background: var(--bg-card); cursor: pointer;">
                <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 9px;">
                    <span>MIN: $50K</span>
                    <span id="budgetValue" style="color: var(--neon-blue); font-weight: 800;">$150K</span>
                    <span>MAX: $500K</span>
                </div>
            </div>

            <button class="pixel-button success" onclick="game.confirmProject()" style="margin-top: 15px;">‚úÖ INICIAR DESARROLLO</button>
        </div>
    </div>

    <!-- üéÆ REVIEW MODAL -->
    <div class="modal" id="reviewModal">
        <div class="modal-content review-modal">
            <div class="modal-title">üìä CR√çTICAS DE JUEGO</div>
            <div class="review-score" id="reviewScore">85</div>
            <div class="review-stars" id="reviewStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
            <div class="review-comments" id="reviewComments">Innovaci√≥n y ejecuci√≥n s√≥lida. Un prometedor inicio.</div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <div class="stat-box" style="flex: 1;">
                    <div class="stat-title">VENTAS</div>
                    <div class="stat-value" id="salesFigure">$450K</div>
                </div>
                <div class="stat-box" style="flex: 1;">
                    <div class="stat-title">UNIDADES</div>
                    <div class="stat-value" id="unitsSold">50K</div>
                </div>
            </div>
            <button class="pixel-button" onclick="game.closeReview()" style="margin-top: 15px;">CONTINUAR</button>
        </div>
    </div>

    <!-- üèÜ ACHIEVEMENT POPUP -->
    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-title" id="achievementTitle">¬°LOGRO DESBLOQUEADO!</div>
        <div class="achievement-desc" id="achievementDesc">Descripci√≥n del logro</div>
    </div>

    <!-- üì¢ NOTIFICATION -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notificationTitle">NOTIFICACI√ìN</div>
        <div class="notification-text" id="notificationText">Mensaje</div>
    </div>

    <!-- üíæ SAVE INDICATOR -->
    <div class="save-indicator" id="saveIndicator">üíæ GUARDANDO...</div>

    <script>
        // üéÆ MOTOR DE JUEGO COMPLETO
        class IndustryEvolutionSimulator {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gameState = {
                    a√±o: 2000,
                    mes: 1,
                    caja: 500000,
                    equipo: 15,
                    maxEquipo: 50,
                    reputacion: 65,
                    hype: 30,
                    moral: 75,
                    juegos: [],
                    proyectoActivo: null,
                    ingresosTotales: 0,
                    nivelEstudio: 1,
                    nivelInvestigacion: 1,
                    crunchMode: false,
                    descuentoContratacion: false,
                    empleados: this.generarEmpleadosIniciales()
                };

                this.teclado = { space: false };
                this.config = {
                    velocidadAnimacion: 0.05,
                    tamanoTile: 32,
                    escalaZoom: 1,
                    offsetX: 0,
                    offsetY: 0
                };

                this.sistemaParticulas = [];
                this.sistemaEventos = [];
                this.logros = {
                    primero: { nombre: "Debutante", descripcion: "Lanza tu primer juego", desbloqueado: false },
                    hit: { nombre: "Golpe de Suerte", descripcion: "Juego >85/100", desbloqueado: false },
                    experto: { nombre: "Productor Veterano", descripcion: "Lanza 10 juegos", desbloqueado: false },
                    millonario: { nombre: "Magnate", descripcion: "$1M en ingresos", desbloqueado: false }
                };

                this.baseDatos = {
                    generos: {
                        accion: { nombre: "Acci√≥n", base: 70, riesgo: 0.3, tendencia: [1,1,1,1,1,1.2,1.3,1.3,1.2,1.1] },
                        rpg: { nombre: "RPG", base: 80, riesgo: 0.5, tendencia: [1,1,1,1,1,1,1.1,1.1,1.2,1.4] },
                        estrategia: { nombre: "Estrategia", base: 75, riesgo: 0.4, tendencia: [1,1,1,1,1,1,1,1,1,1] },
                        puzzle: { nombre: "Puzzle", base: 65, riesgo: 0.2, tendencia: [0.8,0.8,0.9,1,1,1.1,1.2,1.3,1.4,1.5] },
                        terror: { nombre: "Terror", base: 85, riesgo: 0.6, tendencia: [1,1,1,1,1,1,1,1.1,1.2,1.3] },
                        simulacion: { nombre: "Simulaci√≥n", base: 60, riesgo: 0.3, tendencia: [1,1,1,1,1,1,1.1,1.1,1.2,1.3] }
                    },
                    temas: {
                        espacial: { nombre: "Espacial", multi: { accion: 1.2, simulacion: 1.3, rpg: 1.1 } },
                        medieval: { nombre: "Medieval", multi: { rpg: 1.4, estrategia: 1.3, accion: 1.1 } },
                        cyberpunk: { nombre: "Cyberpunk", multi: { rpg: 1.3, accion: 1.2, terror: 1.1 } },
                        fantasia: { nombre: "Fantas√≠a", multi: { rpg: 1.5, estrategia: 1.1, accion: 1 } },
                        zombies: { nombre: "Zombies", multi: { terror: 1.4, accion: 1.2, estrategia: 0.8 } },
                        deportes: { nombre: "Deportes", multi: { simulacion: 1.3, accion: 0.9, puzzle: 0.7 } }
                    },
                    plataformas: {
                        pc: { nombre: "PC", alcance: 1, costo: 1 },
                        consola: { nombre: "Consola", alcance: 1.2, costo: 1.3 },
                        movil: { nombre: "M√≥vil", alcance: 0.8, costo: 0.6 },
                        vr: { nombre: "VR", alcance: 0.3, costo: 1.8 }
                    }
                };

                this.eventosHistoria = {
                    2004: { tipo: 'danger', texto: 'üí• Caso EA Spouse expone crunch. Moral -20%', efecto: () => { this.gameState.moral = Math.max(0, this.gameState.moral - 20); } },
                    2008: { tipo: 'warning', texto: 'üìâ Crisis financiera. Mercado -30%', efecto: () => { /* Aplica multiplicador temporal */ } },
                    2012: { tipo: 'success', texto: 'üì± Boom mobile. Bonus +50% juegos m√≥viles', efecto: () => { this.gameState.hype += 30; } },
                    2017: { tipo: 'danger', texto: 'üé∞ Controversia loot boxes. Riesgo +15%', efecto: () => { this.gameState.reputacion = Math.max(0, this.gameState.reputacion - 15); } },
                    2020: { tipo: 'success', texto: 'üè† Pandemia +200% ventas digitales', efecto: () => { const bonus = 200000; this.gameState.caja += bonus; this.gameState.ingresosTotales += bonus; } },
                    2023: { tipo: 'warning', texto: 'üî• Despidos masivos. Talento -50% coste', efecto: () => { this.gameState.descuentoContratacion = true; } }
                };

                this.inicializar();
            }

            inicializar() {
                this.configurarCanvas();
                this.configurarEventos();
                this.iniciarLoop();
                this.mostrarNotificacion('üéÆ BIENVENIDO', 'Usa ESPACIO para acelerar desarrollo');
            }

            configurarCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                window.addEventListener('resize', () => {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                });
            }

            configurarEventos() {
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') this.teclado.space = true;
                });
                document.addEventListener('keyup', (e) => {
                    if (e.code === 'Space') this.teclado.space = false;
                });

                // Auto-save
                setInterval(() => this.guardarJuego(), 60000);
            }

            // üéÆ LOOP PRINCIPAL
            iniciarLoop() {
                let ultimoTiempo = 0;
                const loop = (timestamp) => {
                    const deltaTime = timestamp - ultimoTiempo;
                    ultimoTiempo = timestamp;

                    this.actualizar(deltaTime);
                    this.renderizar();

                    if (this.teclado.space && this.gameState.proyectoActivo) {
                        this.continuarProyecto();
                    }

                    requestAnimationFrame(loop);
                };
                requestAnimationFrame(loop);
            }

            actualizar(deltaTime) {
                // Actualizar empleados
                this.gameState.empleados.forEach(empleado => empleado.actualizar(deltaTime));

                // Actualizar part√≠culas
                this.sistemaParticulas = this.sistemaParticulas.filter(p => p.actualizar(deltaTime));

                // Actualizar eventos
                this.sistemaEventos = this.sistemaEventos.filter(e => e.actualizar(deltaTime));

                // Check historical events
                if (this.gameState.mes === 1 && this.eventosHistoria[this.gameState.a√±o]) {
                    const evento = this.eventosHistoria[this.gameState.a√±o];
                    this.agregarEvento(evento.tipo, evento.texto);
                    evento.efecto();
                }
            }

            renderizar() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Dibujar oficina isom√©trica
                this.dibujarOficina();

                // Dibujar empleados
                this.gameState.empleados.forEach(empleado => empleado.dibujar(this.ctx));

                // Dibujar part√≠culas
                this.sistemaParticulas.forEach(p => p.dibujar(this.ctx));

                // Dibujar UI overlay
                this.dibujarUI();
            }

            dibujarOficina() {
                const ctx = this.ctx;
                const tile = this.config.tamanoTile;
                const offsetX = this.config.offsetX;
                const offsetY = this.config.offsetY;

                // Grid isom√©trico
                ctx.strokeStyle = 'rgba(100,100,100,0.1)';
                ctx.lineWidth = 1;

                for (let x = 0; x < 50; x++) {
                    for (let y = 0; y < 50; y++) {
                        const isoX = (x - y) * tile / 2 + offsetX;
                        const isoY = (x + y) * tile / 4 + offsetY;
                        
                        ctx.strokeRect(isoX, isoY, tile, tile / 2);
                    }
                }

                // Muebles y workstations
                ctx.fillStyle = '#444';
                for (let i = 0; i < Math.min(this.gameState.equipo, 20); i++) {
                    const x = i % 5;
                    const y = Math.floor(i / 5);
                    const isoX = (x - y) * tile / 2 + offsetX + 200;
                    const isoY = (x + y) * tile / 4 + offsetY + 100;
                    
                    ctx.fillRect(isoX, isoY, tile * 0.8, tile * 0.4);
                    ctx.fillStyle = '#222';
                    ctx.fillRect(isoX + 5, isoY - 10, tile * 0.6, tile * 0.2);
                    ctx.fillStyle = '#444';
                }
            }

            dibujarUI() {
                // Update UI values
                document.getElementById('uiCash').textContent = `$${(this.gameState.caja / 1000).toFixed(0)}K`;
                document.getElementById('uiTeam').textContent = `${this.gameState.equipo} / ${this.gameState.maxEquipo}`;
                document.getElementById('uiRep').textContent = `${this.gameState.reputacion}%`;
                document.getElementById('uiHype').textContent = `${this.gameState.hype}%`;
                
                document.getElementById('cashBar').style.width = `${Math.min(100, this.gameState.caja / 10000)}%`;
                document.getElementById('teamBar').style.width = `${(this.gameState.equipo / this.gameState.maxEquipo) * 100}%`;
                document.getElementById('repBar').style.width = `${this.gameState.reputacion}%`;
                document.getElementById('hypeBar').style.width = `${this.gameState.hype}%`;

                // Update employee list
                this.actualizarListaEmpleados();
            }

            actualizarListaEmpleados() {
                const container = document.getElementById('employeeList');
                container.innerHTML = '';
                
                this.gameState.empleados.slice(0, 5).forEach(empleado => {
                    const div = document.createElement('div');
                    div.className = 'ui-stat';
                    div.style.fontSize = '9px';
                    div.innerHTML = `
                        <span>${empleado.nombre}</span>
                        <span style="color: ${empleado.moral > 60 ? '#00ff41' : '#ffcc00'}">${empleado.moral}%</span>
                    `;
                    container.appendChild(div);
                });
            }

            // üéÆ MEC√ÅNICAS DE JUEGO
            generarEmpleadosIniciales() {
                const nombres = ['Alex', 'Sam', 'Jordan', 'Taylor', 'Morgan', 'Casey', 'Riley', 'Avery'];
                const apellidos = ['Dev', 'Coder', 'Designer', 'Artist', 'Tester', 'Producer'];
                const empleados = [];
                
                for (let i = 0; i < 3; i++) {
                    empleados.push(new Empleado(
                        nombres[Math.floor(Math.random() * nombres.length)] + ' ' + apellidos[Math.floor(Math.random() * apellidos.length)],
                        100 + i * 150,
                        200 + i * 50,
                        this
                    ));
                }
                return empleados;
            }

            contratarEmpleado() {
                const costo = this.gameState.descuentoContratacion ? 25000 : 50000;
                if (this.gameState.caja >= costo && this.gameState.equipo < this.gameState.maxEquipo) {
                    this.gameState.caja -= costo;
                    this.gameState.equipo++;
                    
                    const nombres = ['Alex', 'Sam', 'Jordan', 'Taylor', 'Morgan', 'Casey', 'Riley', 'Avery'];
                    const apellidos = ['Dev', 'Coder', 'Designer', 'Artist', 'Tester', 'Producer'];
                    const emp = new Empleado(
                        nombres[Math.floor(Math.random() * nombres.length)] + ' ' + apellidos[Math.floor(Math.random() * apellidos.length)],
                        200 + Math.random() * 400,
                        150 + Math.random() * 200,
                        this
                    );
                    this.gameState.empleados.push(emp);
                    
                    this.gameState.moral = Math.min(100, this.gameState.moral + 5);
                    this.mostrarNotificacion('üíº CONTRATADO', 'Nuevo miembro en el equipo');
                    this.agregarEvento('success', `Contratado: ${emp.nombre}`);
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', this.gameState.equipo >= this.gameState.maxEquipo ? 'Equipo al m√°ximo' : 'Caja insuficiente');
                }
            }

            invertirMarketing() {
                const costo = 30000;
                if (this.gameState.caja >= costo) {
                    this.gameState.caja -= costo;
                    this.gameState.hype = Math.min(100, this.gameState.hype + 25);
                    this.mostrarNotificacion('üì¢ MARKETING', 'Campa√±a aumenta hype +25');
                    this.agregarEvento('info', 'Campa√±a de marketing lanzada');
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', 'Caja insuficiente');
                }
            }

            investigarTecnologia() {
                const costo = 75000;
                if (this.gameState.caja >= costo) {
                    this.gameState.caja -= costo;
                    this.gameState.nivelInvestigacion++;
                    this.mostrarNotificacion('üî¨ INVESTIGACI√ìN', `Nivel ${this.gameState.nivelInvestigacion} desbloqueado`);
                    this.agregarEvento('success', 'Investigaci√≥n completada');
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', 'Caja insuficiente');
                }
            }

            mudarOficina() {
                const costo = 150000;
                if (this.gameState.caja >= costo && this.gameState.nivelEstudio < 5) {
                    this.gameState.caja -= costo;
                    this.gameState.nivelEstudio++;
                    this.gameState.maxEquipo += 25;
                    this.gameState.moral = Math.min(100, this.gameState.moral + 20);
                    this.mostrarNotificacion('üè¢ MUDANZA', `Oficina nivel ${this.gameState.nivelEstudio} activa`);
                    this.agregarEvento('success', `Oficina mejorada: +25 equipo m√°ximo`);
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', this.gameState.nivelEstudio >= 5 ? 'M√°ximo nivel' : 'Caja insuficiente');
                }
            }

            alternarCrunch() {
                this.gameState.crunchMode = !this.gameState.crunchMode;
                document.getElementById('crunchStatus').textContent = this.gameState.crunchMode ? 'ON' : 'OFF';
                this.mostrarNotificacion('üî• CRUNCH', this.gameState.crunchMode ? 'Activado: +velocidad, -moral' : 'Desactivado');
                this.agregarEvento('warning', `Crunch mode ${this.gameState.crunchMode ? 'ACTIVADO' : 'DESACTIVADO'}`);
            }

            trabajoContrato() {
                const ingresos = 40000;
                this.gameState.caja += ingresos;
                this.gameState.ingresosTotales += ingresos;
                this.mostrarNotificacion('üìã CONTRATO', `+${ingresos / 1000}K de ingresos seguros`);
                this.agregarEvento('info', 'Trabajo por contrato completado');
                this.actualizarUI();
            }

            construccionEquipo() {
                const costo = 20000;
                if (this.gameState.caja >= costo) {
                    this.gameState.caja -= costo;
                    this.gameState.moral = Math.min(100, this.gameState.moral + 15);
                    this.mostrarNotificacion('üèñÔ∏è RETIRO', 'Moral de equipo +15');
                    this.agregarEvento('success', 'Evento de team building completado');
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', 'Caja insuficiente');
                }
            }

            investigacionAI() {
                this.mostrarNotificacion('üîí PR√ìXIMAMENTE', 'Feature en desarrollo');
            }

            patentarTecnologia() {
                this.mostrarNotificacion('üîí PR√ìXIMAMENTE', 'Feature en desarrollo');
            }

            // üéÆ PROYECTO
            iniciarNuevoProyecto() {
                if (this.gameState.proyectoActivo) {
                    this.mostrarNotificacion('‚ö†Ô∏è PROYECTO ACTIVO', 'Termina el juego actual primero');
                    return;
                }
                document.getElementById('newGameModal').classList.add('active');
            }

            continuarProyecto() {
                if (!this.gameState.proyectoActivo) return;
                document.getElementById('continueBtn').classList.add('bouncing');
                setTimeout(() => document.getElementById('continueBtn').classList.remove('bouncing'), 300);
                this.desarrollarProyecto();
            }

            desarrollarProyecto() {
                const proyecto = this.gameState.proyectoActivo;
                if (!proyecto) return;

                const velocidad = this.gameState.crunchMode ? 25 : 15;
                const penalidad = this.gameState.crunchMode ? 5 : 0;

                proyecto.progreso += velocidad;
                this.gameState.moral = Math.max(0, this.gameState.moral - penalidad);

                // Eventos random durante desarrollo
                if (Math.random() < 0.05) this.eventoDesarrolloRandom();

                // Finalizar proyecto
                if (proyecto.progreso >= 100) {
                    this.lanzarJuego();
                }

                // Actualizar UI
                document.getElementById('projectProgress').textContent = `${proyecto.progreso}%`;
                document.getElementById('progressBar').style.width = `${proyecto.progreso}%`;

                this.actualizarUI();
            }

            eventoDesarrolloRandom() {
                const eventos = [
                    { tipo: 'warning', texto: 'üêõ ¬°Bug cr√≠tico! -10% progreso', efecto: () => { this.gameState.proyectoActivo.progreso -= 10; } },
                    { tipo: 'success', texto: '‚≠ê ¬°Estrella del equipo! +15% progreso', efecto: () => { this.gameState.proyectoActivo.progreso += 15; } },
                    { tipo: 'info', texto: 'üí° ¬°Inspiraci√≥n! +5 calidad', efecto: () => { this.gameState.proyectoActivo.calidad += 5; } }
                ];
                const evento = eventos[Math.floor(Math.random() * eventos.length)];
                evento.efecto();
                this.agregarEvento(evento.tipo, evento.texto);
            }

            lanzarJuego() {
                const proyecto = this.gameState.proyectoActivo;
                const nota = this.calcularNotaFinal(proyecto);
                const ventas = this.calcularVentas(proyecto, nota);

                // Actualizar estado
                this.gameState.caja += ventas;
                this.gameState.ingresosTotales += ventas;
                this.gameState.juegos.push({...proyecto, nota, ventas, a√±o: this.gameState.a√±o});

                // Actualizar reputaci√≥n y moral
                const cambioRep = nota > 80 ? 8 : nota > 60 ? 3 : -5;
                this.gameState.reputacion = Math.max(0, Math.min(100, this.gameState.reputacion + cambioRep));
                this.gameState.hype = Math.max(10, this.gameState.hype - 30);
                this.gameState.moral = Math.min(100, this.gameState.moral + 10);

                // Limpiar proyecto
                this.gameState.proyectoActivo = null;
                document.getElementById('activeProject').style.display = 'none';
                document.getElementById('newGameBtn').style.display = 'block';
                document.getElementById('continueBtn').style.display = 'none';

                // Mostrar review
                this.mostrarReview(nota, ventas);

                // Eventos post-lanzamiento
                if (nota > 80 && Math.random() < 0.3) this.eventoPostLanzamiento(proyecto, ventas);

                this.agregarEvento(nota > 80 ? 'success' : nota > 60 ? 'info' : 'danger',
                    `üéÆ ${this.baseDatos.generos[proyecto.genero].nombre} lanzado: ${nota.toFixed(1)}/100`);
                
                this.comprobarLogros();
                this.actualizarUI();
            }

            calcularNotaFinal(proyecto) {
                const genero = this.baseDatos.generos[proyecto.genero];
                const tema = this.baseDatos.temas[proyecto.tema];
                const plataforma = this.baseDatos.plataformas[proyecto.plataforma];
                
                const a√±oIndex = Math.min(9, Math.floor((this.gameState.a√±o - 2000) / 3));
                const tendencia = genero.tendencia[a√±oIndex];
                
                let nota = genero.base * tendencia;
                nota *= (tema.multi[proyecto.genero] || 1);
                nota *= (proyecto.presupuesto / 100000) * 0.5 + 0.5;
                nota *= (this.gameState.reputacion / 100);
                nota *= (this.gameState.moral / 100) * 0.5 + 0.5;
                nota *= (this.gameState.equipo / 30) * 0.3 + 0.7;
                nota *= 0.8 + Math.random() * 0.4;

                return Math.min(100, Math.max(0, nota));
            }

            calcularVentas(proyecto, nota) {
                const base = proyecto.presupuesto * 3;
                const bonusNota = (nota - 50) / 50;
                const bonusHype = this.gameState.hype / 100;
                const a√±oMulti = this.gameState.a√±o < 2010 ? 0.8 : this.gameState.a√±o < 2020 ? 1.0 : 1.2;
                return Math.floor(base * (1 + bonusNota) * (1 + bonusHype) * a√±oMulti);
            }

            eventoPostLanzamiento(proyecto, ventas) {
                // DLC
                if (Math.random() < 0.3) {
                    const dlc = ventas * 0.2;
                    this.gameState.caja += dlc;
                    this.gameState.ingresosTotales += dlc;
                    this.agregarEvento('success', `üì¶ DLC genera +$${(dlc/1000).toFixed(0)}K`);
                }
                // Premios
                if (Math.random() < 0.1) {
                    const premio = 50000;
                    this.gameState.caja += premio;
                    this.gameState.reputacion = Math.min(100, this.gameState.reputacion + 10);
                    this.agregarEvento('success', `üèÜ ¬°Game of the Year! +$50K`);
                }
            }

            mostrarReview(nota, ventas) {
                document.getElementById('reviewScore').textContent = nota.toFixed(0);
                document.getElementById('reviewStars').textContent = '‚òÖ'.repeat(Math.floor(nota / 20)) + '‚òÜ'.repeat(5 - Math.floor(nota / 20));
                document.getElementById('salesFigure').textContent = `$${(ventas / 1000).toFixed(0)}K`;
                document.getElementById('unitsSold').textContent = `${(ventas / 10).toFixed(0)}K`;
                
                const comentarios = nota >= 90 ? "¬°Obra maestra! Game of the Year." :
                                  nota >= 80 ? "¬°Excelente! Compra obligatoria." :
                                  nota >= 70 ? "Buen juego con peque√±os fallos." :
                                  nota >= 60 ? "Experiencia promedio." :
                                  "Decepcionante. Necesita mejora.";
                document.getElementById('reviewComments').textContent = comentarios;
                
                document.getElementById('reviewModal').classList.add('active');
            }

            cerrarReview() {
                document.getElementById('reviewModal').classList.remove('active');
            }

            // üéÆ UTILIDADES
            actualizarUI() {
                document.getElementById('uiCash').textContent = `$${(this.gameState.caja / 1000).toFixed(0)}K`;
                document.getElementById('uiTeam').textContent = `${this.gameState.equipo} / ${this.gameState.maxEquipo}`;
                document.getElementById('uiRep').textContent = `${this.gameState.reputacion}%`;
                document.getElementById('uiHype').textContent = `${this.gameState.hype}%`;
                
                document.getElementById('cashBar').style.width = `${Math.min(100, this.gameState.caja / 10000)}%`;
                document.getElementById('teamBar').style.width = `${(this.gameState.equipo / this.gameState.maxEquipo) * 100}%`;
                document.getElementById('repBar').style.width = `${this.gameState.reputacion}%`;
                document.getElementById('hypeBar').style.width = `${this.gameState.hype}%`;
                
                // Actualizar proyecto activo
                if (this.gameState.proyectoActivo) {
                    document.getElementById('activeProject').style.display = 'block';
                    document.getElementById('newGameBtn').style.display = 'none';
                    document.getElementById('continueBtn').style.display = 'block';
                    document.getElementById('projectName').textContent = 
                        `${this.baseDatos.generos[this.gameState.proyectoActivo.genero].nombre}`;
                    document.getElementById('projectProgress').textContent = `${this.gameState.proyectoActivo.progreso}%`;
                    document.getElementById('progressBar').style.width = `${this.gameState.proyectoActivo.progreso}%`;
                } else {
                    document.getElementById('activeProject').style.display = 'none';
                    document.getElementById('newGameBtn').style.display = 'block';
                    document.getElementById('continueBtn').style.display = 'none';
                }

                this.comprobarLogros();
            }

            comprobarLogros() {
                if (this.gameState.juegos.length === 1 && !this.logros.primero.desbloqueado) {
                    this.desbloquearLogro(this.logros.primero);
                }
                if (this.gameState.juegos.length >= 10 && !this.logros.experto.desbloqueado) {
                    this.desbloquearLogro(this.logros.experto);
                }
                if (this.gameState.ingresosTotales >= 1000000 && !this.logros.millonario.desbloqueado) {
                    this.desbloquearLogro(this.logros.millonario);
                }
                const hit = this.gameState.juegos.find(j => j.nota >= 85);
                if (hit && !this.logros.hit.desbloqueado) {
                    this.desbloquearLogro(this.logros.hit);
                }
            }

            desbloquearLogro(logro) {
                logro.desbloqueado = true;
                document.getElementById('achievementTitle').textContent = `üèÜ ${logro.nombre}`;
                document.getElementById('achievementDesc').textContent = logro.descripcion;
                document.getElementById('achievementPopup').classList.add('active');
                setTimeout(() => document.getElementById('achievementPopup').classList.remove('active'), 4000);
                this.agregarEvento('success', `¬°Logro desbloqueado: ${logro.nombre}!`);
            }

            agregarEvento(tipo, texto) {
                const log = document.getElementById('eventLog');
                const evento = document.createElement('div');
                evento.className = `event-item ${tipo}`;
                evento.innerHTML = `<div class="event-header">${this.gameState.a√±o}-${this.gameState.mes.toString().padStart(2, '0')}</div>${texto}`;
                log.insertBefore(evento, log.firstChild);
                while (log.children.length > 10) log.removeChild(log.lastChild);
            }

            mostrarNotificacion(titulo, texto) {
                document.getElementById('notificationTitle').textContent = titulo;
                document.getElementById('notificationText').textContent = texto;
                const notif = document.getElementById('notification');
                notif.classList.add('show');
                setTimeout(() => notif.classList.remove('show'), 4000);
            }

            guardarJuego() {
                localStorage.setItem('industrySimGOTY', JSON.stringify(this.gameState));
                document.getElementById('saveIndicator').classList.add('show');
                setTimeout(() => document.getElementById('saveIndicator').classList.remove('show'), 1000);
            }

            cargarJuego() {
                const guardado = localStorage.getItem('industrySimGOTY');
                if (guardado) {
                    Object.assign(this.gameState, JSON.parse(guardado));
                    this.gameState.empleados = this.gameState.empleados.map(e => Object.assign(new Empleado('', 0, 0, this), e));
                    this.actualizarUI();
                    this.mostrarNotificacion('üìÇ PARTIDA CARGADA', 'Contin√∫a desde tu √∫ltimo guardado');
                }
            }

            actualizarBudget(valor) {
                document.getElementById('budgetValue').textContent = `$${(valor / 1000).toFixed(0)}K`;
            }

            selectOption(element) {
                const type = element.dataset.type;
                document.querySelectorAll(`[data-type="${type}"]`).forEach(el => el.classList.remove('selected'));
                element.classList.add('selected');
            }

            confirmProject() {
                const genero = document.querySelector('[data-type="genero"].selected')?.dataset.value;
                const tema = document.querySelector('[data-type="tema"].selected')?.dataset.value;
                const plataforma = document.querySelector('[data-type="plataforma"].selected')?.dataset.value;
                const presupuesto = parseInt(document.getElementById('budgetSlider').value);

                if (!genero || !tema || !plataforma) {
                    this.mostrarNotificacion('‚ùå ERROR', 'Selecciona todas las opciones');
                    return;
                }

                if (this.gameState.caja < presupuesto) {
                    this.mostrarNotificacion('‚ùå ERROR', `Necesitas $${presupuesto.toLocaleString()}`);
                    return;
                }

                this.gameState.caja -= presupuesto;
                this.gameState.proyectoActivo = {
                    genero, tema, plataforma, presupuesto,
                    progreso: 0, calidad: 0,
                    notaEsperada: this.calcularNotaEsperada(genero, tema, plataforma, presupuesto)
                };

                document.getElementById('newGameModal').classList.remove('active');
                document.querySelectorAll('.option-tile').forEach(el => el.classList.remove('selected'));
                
                this.mostrarNotificacion('üéÆ PROYECTO INICIADO', `${this.baseDatos.generos[genero].nombre}`);
                this.actualizarUI();
            }

            calcularNotaEsperada(genero, tema, plataforma, presupuesto) {
                const gen = this.baseDatos.generos[genero];
                const tem = this.baseDatos.temas[tema];
                const plat = this.baseDatos.plataformas[plataforma];
                
                const a√±oIndex = Math.min(9, Math.floor((this.gameState.a√±o - 2000) / 3));
                const tendencia = gen.tendencia[a√±oIndex];
                
                return gen.base * tendencia * (tem.multi[genero] || 1) * (presupuesto / 100000) * (this.gameState.reputacion / 100);
            }

            closeReview() {
                document.getElementById('reviewModal').classList.remove('active');
            }
        }

        // üéÆ CLASE EMPLEADO
        class Empleado {
            constructor(nombre, x, y, juego) {
                this.nombre = nombre;
                this.x = x;
                this.y = y;
                this.juego = juego;
                this.moral = 75;
                this.habilidad = Math.random() * 0.5 + 0.5;
                this.estado = 'idle'; // idle, walk, work, celebrate, stress
                this.frame = 0;
                this.velocidad = 2;
                this.destinoX = x;
                this.destinoY = y;
                this.color = `hsl(${Math.random() * 360}, 70%, 50%)`;
            }

            actualizar(deltaTime) {
                this.frame += deltaTime * 0.01;

                // Movimiento hacia destino
                if (this.estado === 'walk') {
                    const dx = this.destinoX - this.x;
                    const dy = this.destinoY - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist > 5) {
                        this.x += (dx / dist) * this.velocidad;
                        this.y += (dy / dist) * this.velocidad;
                    } else {
                        this.estado = 'idle';
                    }
                }

                // Cambiar estado basado en moral y crunch
                if (this.juego.gameState.crunchMode && this.moral < 40) {
                    this.estado = 'stress';
                } else if (this.juego.gameState.proyectoActivo && this.moral > 60) {
                    this.estado = 'work';
                } else if (Math.random() < 0.001) {
                    this.caminarAleatorio();
                }
            }

            dibujar(ctx) {
                const size = 16;
                const x = this.x - size / 2;
                const y = this.y - size / 2;

                // Cuerpo
                ctx.fillStyle = this.color;
                ctx.fillRect(x, y, size, size);

                // Cabeza
                ctx.fillStyle = '#fdbcb4';
                ctx.fillRect(x + 4, y - 8, 8, 8);

                // Estado visual
                if (this.estado === 'stress') {
                    ctx.fillStyle = 'rgba(255, 0, 64, 0.5)';
                    ctx.fillRect(x, y, size, size);
                } else if (this.estado === 'work') {
                    ctx.fillStyle = 'rgba(0, 184, 255, 0.3)';
                    ctx.fillRect(x - 2, y - 2, size + 4, size + 4);
                }

                // Nombre
                ctx.fillStyle = '#ffffff';
                ctx.font = '8px Pixelify Sans';
                ctx.fillText(this.nombre.split(' ')[0], x - 10, y + size + 10);
            }

            caminarAleatorio() {
                const tile = this.juego.config.tamanoTile;
                this.destinoX = 200 + Math.random() * 400;
                this.destinoY = 150 + Math.random() * 200;
                this.estado = 'walk';
            }

            celebrar() {
                this.estado = 'celebrate';
                this.moral = Math.min(100, this.moral + 10);
                setTimeout(() => this.estado = 'idle', 3000);
            }
        }

        // üéÆ INICIAR JUEGO
        window.addEventListener('load', () => {
            window.game = new IndustryEvolutionSimulator();
            window.game.cargarJuego();
        });
    </script>
</body>
</html>
