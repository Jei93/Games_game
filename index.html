<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industry Evolution Simulator - FIXED EDITION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Pixelify+Sans:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-panel: #2a2a2a;
            --bg-card: #3a3a3a;
            --bg-card-hover: #4a4a4a;
            --neon-green: #00ff41;
            --neon-blue: #00b8ff;
            --neon-yellow: #ffcc00;
            --neon-red: #ff0040;
            --neon-purple: #b967ff;
            --pixel-border: #555555;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
        }

        body {
            font-family: 'Pixelify Sans', monospace;
            background: radial-gradient(ellipse at center, #1a0033 0%, var(--bg-primary) 100%);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        canvas {
            display: block;
            background: var(--bg-secondary);
            border: 3px solid var(--pixel-border);
            box-shadow: 0 0 20px rgba(0, 184, 255, 0.3);
        }

        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .ui-panel {
            position: absolute;
            background: rgba(26, 26, 26, 0.95);
            border: 3px solid var(--pixel-border);
            padding: 10px;
            pointer-events: all;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ui-panel.hidden {
            transform: translateX(-100%);
        }

        .ui-panel.left {
            left: 0;
            top: 0;
            width: 220px;
            height: 100%;
            overflow-y: auto;
        }

        .ui-panel.right {
            right: 0;
            top: 0;
            width: 200px;
            height: 100%;
            overflow-y: auto;
        }

        .ui-panel.bottom {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            max-width: 90%;
            height: 100px;
        }

        .ui-panel.center {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: auto;
            max-height: 200px;
        }

        .ui-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            color: var(--neon-blue);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 8px var(--neon-blue);
        }

        .ui-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 10px;
        }

        .ui-stat-label {
            color: var(--text-secondary);
        }

        .ui-stat-value {
            color: var(--neon-green);
            font-weight: 700;
        }

        .ui-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-panel);
            border: 1px solid var(--pixel-border);
            position: relative;
            margin-top: 4px;
            overflow: hidden;
        }

        .ui-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .cash-fill { background: linear-gradient(90deg, var(--neon-green), #00cc33); }
        .team-fill { background: linear-gradient(90deg, var(--neon-blue), #0088cc); }
        .rep-fill { background: linear-gradient(90deg, var(--neon-yellow), #cc9900); }
        .hype-fill { background: linear-gradient(90deg, var(--neon-purple), #9966cc); }
        .progress-fill { background: linear-gradient(90deg, var(--neon-purple), #b967ff); }

        .pixel-button {
            font-family: 'Pixelify Sans', monospace;
            font-size: 10px;
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            color: var(--text-primary);
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.15s;
            display: block;
            width: 100%;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .pixel-button:hover {
            background: var(--neon-blue);
            color: var(--bg-primary);
            border-color: var(--neon-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 184, 255, 0.3);
        }

        .pixel-button:active {
            transform: scale(0.95);
        }

        .pixel-button.danger {
            border-color: var(--neon-red);
        }

        .pixel-button.danger:hover {
            background: var(--neon-red);
        }

        .pixel-button.success {
            border-color: var(--neon-green);
        }

        .pixel-button.success:hover {
            background: var(--neon-green);
        }

        .pixel-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            place-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: grid;
        }

        .modal-content {
            background: var(--bg-panel);
            border: 4px solid var(--neon-blue);
            padding: 20px;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalPop 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-title {
            font-size: 14px;
            color: var(--neon-blue);
            margin-bottom: 15px;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .option-tile {
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-size: 9px;
        }

        .option-tile:hover {
            border-color: var(--neon-blue);
            transform: scale(1.05);
        }

        .option-tile.selected {
            border-color: var(--neon-green);
            background: rgba(0, 255, 65, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
        }

        .option-icon {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .review-modal .review-score {
            font-size: 48px;
            font-weight: 900;
            color: var(--neon-green);
            text-shadow: 3px 3px 0 var(--bg-primary);
            text-align: center;
            margin: 20px 0;
        }

        .review-modal .review-stars {
            font-size: 24px;
            color: var(--neon-yellow);
            text-align: center;
            margin-bottom: 15px;
        }

        .review-modal .review-comments {
            background: var(--bg-card);
            border: 2px solid var(--pixel-border);
            padding: 12px;
            font-size: 10px;
            line-height: 1.4;
            margin: 15px 0;
        }

        .stat-box {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--pixel-border);
            padding: 8px;
            margin: 0 5px;
        }

        .stat-title {
            font-size: 9px;
            color: var(--text-secondary);
            text-align: center;
        }

        .stat-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--neon-green);
            text-align: center;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, var(--neon-purple), #ff00ff);
            border: 4px solid var(--neon-yellow);
            padding: 20px 30px;
            z-index: 2000;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-align: center;
        }

        .achievement-popup.active {
            transform: translate(-50%, -50%) scale(1);
        }

        .achievement-title {
            font-size: 14px;
            font-weight: 900;
            margin-bottom: 5px;
            color: var(--bg-primary);
        }

        .achievement-desc {
            font-size: 10px;
            color: var(--text-primary);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: -400px;
            background: var(--bg-panel);
            border: 2px solid var(--neon-blue);
            padding: 10px 15px;
            max-width: 300px;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1500;
        }

        .notification.show {
            right: 20px;
        }

        .notification-title {
            color: var(--neon-blue);
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 10px;
        }

        .notification-text {
            font-size: 9px;
            color: var(--text-secondary);
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: -200px;
            background: var(--neon-green);
            color: var(--bg-primary);
            padding: 8px 12px;
            font-size: 10px;
            font-weight: 700;
            transition: right 0.3s;
            z-index: 1500;
        }

        .save-indicator.show {
            right: 20px;
        }

        .event-log {
            position: absolute;
            bottom: 120px;
            left: 10px;
            width: 300px;
            max-height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--pixel-border);
            padding: 10px;
            overflow-y: auto;
            font-size: 9px;
            z-index: 50;
        }

        .event-item {
            margin-bottom: 5px;
            padding: 3px;
            border-left: 3px solid transparent;
        }

        .event-item.success {
            border-left-color: var(--neon-green);
        }

        .event-item.danger {
            border-left-color: var(--neon-red);
        }

        .event-item.warning {
            border-left-color: var(--neon-yellow);
        }

        .event-item.info {
            border-left-color: var(--neon-blue);
        }

        .event-header {
            color: var(--text-secondary);
            font-size: 8px;
        }

        .project-panel {
            display: none;
            background: rgba(42, 42, 42, 0.95);
            border: 2px solid var(--neon-purple);
            padding: 8px;
            margin-top: 10px;
        }

        .project-panel.active {
            display: block;
        }

        .bottom-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .bottom-buttons .pixel-button {
            width: auto;
            min-width: 150px;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .bouncing {
            animation: bounce 0.3s ease-in-out;
        }

        @media (max-width: 1024px) {
            .ui-panel.left, .ui-panel.right {
                width: 180px;
            }
            .selection-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <!-- üéÆ UI OVERLAY -->
    <div class="ui-overlay">
        <!-- LEFT PANEL - RESOURCES -->
        <div class="ui-panel left" id="leftPanel">
            <div class="ui-title">üìä STUDIO RESOURCES</div>
            
            <div class="ui-stat">
                <span class="ui-stat-label">üí∞ CASH</span>
                <span class="ui-stat-value" id="uiCash">$500K</span>
            </div>
            <div class="ui-bar"><div class="ui-fill cash-fill" id="cashBar" style="width: 50%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">üë• TEAM</span>
                <span class="ui-stat-value" id="uiTeam">15 / 50</span>
            </div>
            <div class="ui-bar"><div class="ui-fill team-fill" id="teamBar" style="width: 30%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">‚≠ê REPUTATION</span>
                <span class="ui-stat-value" id="uiRep">65%</span>
            </div>
            <div class="ui-bar"><div class="ui-fill rep-fill" id="repBar" style="width: 65%"></div></div>

            <div class="ui-stat">
                <span class="ui-stat-label">üî• HYPE</span>
                <span class="ui-stat-value" id="uiHype">30%</span>
            </div>
            <div class="ui-bar"><div class="ui-fill hype-fill" id="hypeBar" style="width: 30%"></div></div>

            <button class="pixel-button" onclick="game.hireEmployee()">üíº HIRE STAFF</button>
            <button class="pixel-button" onclick="game.investMarketing()">üì¢ MARKETING</button>
            <button class="pixel-button" onclick="game.researchTech()">üî¨ R&D</button>
            <button class="pixel-button" onclick="game.moveOffice()">üè¢ MOVE OFFICE</button>
            <button class="pixel-button danger" onclick="game.resetGame()">üîÑ NEW GAME</button>
        </div>

        <!-- RIGHT PANEL - EMPLOYEES -->
        <div class="ui-panel right" id="rightPanel">
            <div class="ui-title">üë• ACTIVE TEAM</div>
            <div id="employeeList"></div>
        </div>

        <!-- CENTER PANEL - PROJECT STATUS -->
        <div class="ui-panel center" id="activeProjectPanel">
            <div class="ui-title">üéÆ ACTIVE PROJECT</div>
            <div class="project-panel" id="activeProject">
                <div class="ui-stat">
                    <span class="ui-stat-label" id="projectName">None</span>
                    <span class="ui-stat-value" id="projectProgress">0%</span>
                </div>
                <div class="ui-bar"><div class="ui-fill progress-fill" id="progressBar" style="width: 0%"></div></div>
            </div>
            <div class="ui-stat">
                <span class="ui-stat-label">YEAR</span>
                <span class="ui-stat-value" id="uiYear">2000</span>
            </div>
        </div>

        <!-- BOTTOM PANEL - ACTIONS -->
        <div class="ui-panel bottom" id="bottomPanel">
            <div class="bottom-buttons">
                <button class="pixel-button danger" onclick="game.toggleCrunch()" id="crunchBtn">
                    üî• CRUNCH: <span id="crunchStatus">OFF</span>
                </button>
                <button class="pixel-button success" onclick="game.startNewProject()" id="newGameBtn">
                    üéÆ NEW PROJECT
                </button>
                <button class="pixel-button" onclick="game.continueProject()" id="continueBtn" style="display: none;">
                    ‚öôÔ∏è CONTINUE DEV
                </button>
                <button class="pixel-button" onclick="game.takeContract()">
                    üìã CONTRACT JOB
                </button>
            </div>
        </div>

        <!-- EVENT LOG -->
        <div class="event-log" id="eventLog"></div>
    </div>

    <!-- NEW GAME MODAL -->
    <div class="modal" id="newGameModal">
        <div class="modal-content">
            <div class="modal-title">üéÆ CREATE NEW GAME PROJECT</div>
            
            <div class="modal-section">
                <h4>üé≤ GENRE</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="genre" data-value="accion" onclick="game.selectOption(this)">
                        <div class="option-icon">üéÆ</div>
                        <div>ACTION</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="rpg" onclick="game.selectOption(this)">
                        <div class="option-icon">‚öîÔ∏è</div>
                        <div>RPG</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="estrategia" onclick="game.selectOption(this)">
                        <div class="option-icon">üó∫Ô∏è</div>
                        <div>STRATEGY</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="puzzle" onclick="game.selectOption(this)">
                        <div class="option-icon">üß©</div>
                        <div>PUZZLE</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="terror" onclick="game.selectOption(this)">
                        <div class="option-icon">üëª</div>
                        <div>HORROR</div>
                    </div>
                    <div class="option-tile" data-type="genre" data-value="simulacion" onclick="game.selectOption(this)">
                        <div class="option-icon">üè≠</div>
                        <div>SIMULATION</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üé® THEME</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="tema" data-value="espacial" onclick="game.selectOption(this)">
                        <div class="option-icon">üöÄ</div>
                        <div>SPACE</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="medieval" onclick="game.selectOption(this)">
                        <div class="option-icon">üè∞</div>
                        <div>MEDIEVAL</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="cyberpunk" onclick="game.selectOption(this)">
                        <div class="option-icon">üåÜ</div>
                        <div>CYBERPUNK</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="fantasia" onclick="game.selectOption(this)">
                        <div class="option-icon">ü¶Ñ</div>
                        <div>FANTASY</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="zombies" onclick="game.selectOption(this)">
                        <div class="option-icon">üßü</div>
                        <div>ZOMBIES</div>
                    </div>
                    <div class="option-tile" data-type="tema" data-value="deportes" onclick="game.selectOption(this)">
                        <div class="option-icon">‚öΩ</div>
                        <div>SPORTS</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üì∫ PLATFORM</h4>
                <div class="selection-grid">
                    <div class="option-tile" data-type="plataforma" data-value="pc" onclick="game.selectOption(this)">
                        <div class="option-icon">üíª</div>
                        <div>PC</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="consola" onclick="game.selectOption(this)">
                        <div class="option-icon">üéÆ</div>
                        <div>CONSOLE</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="movil" onclick="game.selectOption(this)">
                        <div class="option-icon">üì±</div>
                        <div>MOBILE</div>
                    </div>
                    <div class="option-tile" data-type="plataforma" data-value="vr" onclick="game.selectOption(this)">
                        <div class="option-icon">ü•Ω</div>
                        <div>VR</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>üí∞ BUDGET</h4>
                <input type="range" id="budgetSlider" min="50000" max="500000" value="150000" 
                       oninput="game.updateBudget(this.value)" 
                       style="width: 100%; height: 10px; background: var(--bg-card); cursor: pointer;">
                <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 9px;">
                    <span>MIN: $50K</span>
                    <span id="budgetValue" style="color: var(--neon-blue); font-weight: 800;">$150K</span>
                    <span>MAX: $500K</span>
                </div>
            </div>

            <button class="pixel-button success" onclick="game.confirmProject()" style="margin-top: 15px;">‚úÖ START DEVELOPMENT</button>
        </div>
    </div>

    <!-- REVIEW MODAL -->
    <div class="modal" id="reviewModal">
        <div class="modal-content review-modal">
            <div class="modal-title">üìä GAME REVIEWS</div>
            <div class="review-score" id="reviewScore">85</div>
            <div class="review-stars" id="reviewStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
            <div class="review-comments" id="reviewComments">Solid execution.</div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <div class="stat-box">
                    <div class="stat-title">SALES</div>
                    <div class="stat-value" id="salesFigure">$450K</div>
                </div>
                <div class="stat-box">
                    <div class="stat-title">UNITS</div>
                    <div class="stat-value" id="unitsSold">50K</div>
                </div>
            </div>
            <button class="pixel-button" onclick="game.closeReview()">CONTINUE</button>
        </div>
    </div>

    <!-- ACHIEVEMENT POPUP -->
    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-title" id="achievementTitle">ACHIEVEMENT UNLOCKED!</div>
        <div class="achievement-desc" id="achievementDesc">Description</div>
    </div>

    <!-- NOTIFICATION -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notificationTitle">NOTIFICATION</div>
        <div class="notification-text" id="notificationText">Message</div>
    </div>

    <!-- SAVE INDICATOR -->
    <div class="save-indicator" id="saveIndicator">üíæ SAVING...</div>

    <script>
        // üéÆ GAME ENGINE
        class IndustryEvolutionSimulator {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gameState = {
                    a√±o: 2000,
                    mes: 1,
                    caja: 500000,
                    equipo: 3,
                    maxEquipo: 50,
                    reputacion: 65,
                    hype: 30,
                    moral: 75,
                    juegos: [],
                    proyectoActivo: null,
                    ingresosTotales: 0,
                    nivelEstudio: 1,
                    nivelInvestigacion: 1,
                    crunchMode: false,
                    descuentoContratacion: false,
                    empleados: []
                };

                this.teclado = { space: false };
                this.config = {
                    velocidadAnimacion: 0.05,
                    tamanoTile: 32,
                    escalaZoom: 1,
                    offsetX: 0,
                    offsetY: 0,
                    tickSpeed: 1500
                };

                this.sistemaParticulas = [];
                this.logros = {
                    primero: { nombre: "First Game", descripcion: "Launch your first game", desbloqueado: false },
                    hit: { nombre: "Hit Game", descripcion: "Score >85/100", desbloqueado: false },
                    experto: { nombre: "Veteran", descripcion: "Launch 10 games", desbloqueado: false },
                    millonario: { nombre: "Mogul", descripcion: "Earn $1M total", desbloqueado: false }
                };

                this.baseDatos = {
                    generos: {
                        accion: { nombre: "Action", base: 70, riesgo: 0.3, tendencia: [1,1,1,1,1,1.2,1.3,1.3,1.2,1.1] },
                        rpg: { nombre: "RPG", base: 80, riesgo: 0.5, tendencia: [1,1,1,1,1,1,1.1,1.1,1.2,1.4] },
                        estrategia: { nombre: "Strategy", base: 75, riesgo: 0.4, tendencia: [1,1,1,1,1,1,1,1,1,1] },
                        puzzle: { nombre: "Puzzle", base: 65, riesgo: 0.2, tendencia: [0.8,0.8,0.9,1,1,1.1,1.2,1.3,1.4,1.5] },
                        terror: { nombre: "Horror", base: 85, riesgo: 0.6, tendencia: [1,1,1,1,1,1,1,1.1,1.2,1.3] },
                        simulacion: { nombre: "Simulation", base: 60, riesgo: 0.3, tendencia: [1,1,1,1,1,1,1.1,1.1,1.2,1.3] }
                    },
                    temas: {
                        espacial: { nombre: "Space", multi: { accion: 1.2, simulacion: 1.3, rpg: 1.1 } },
                        medieval: { nombre: "Medieval", multi: { rpg: 1.4, estrategia: 1.3, accion: 1.1 } },
                        cyberpunk: { nombre: "Cyberpunk", multi: { rpg: 1.3, accion: 1.2, terror: 1.1 } },
                        fantasia: { nombre: "Fantasy", multi: { rpg: 1.5, estrategia: 1.1, accion: 1 } },
                        zombies: { nombre: "Zombies", multi: { terror: 1.4, accion: 1.2, estrategia: 0.8 } },
                        deportes: { nombre: "Sports", multi: { simulacion: 1.3, accion: 0.9, puzzle: 0.7 } }
                    },
                    plataformas: {
                        pc: { nombre: "PC", alcance: 1, costo: 1 },
                        consola: { nombre: "Console", alcance: 1.2, costo: 1.3 },
                        movil: { nombre: "Mobile", alcance: 0.8, costo: 0.6 },
                        vr: { nombre: "VR", alcance: 0.3, costo: 1.8 }
                    }
                };

                this.eventosHistoria = {
                    2004: { tipo: 'danger', texto: 'üí• EA Spouse scandal! Morale -20%', efecto: () => { this.gameState.moral = Math.max(0, this.gameState.moral - 20); } },
                    2008: { tipo: 'warning', texto: 'üìâ Financial crisis! Market -30%', efecto: () => { this.gameState.hype = Math.max(0, this.gameState.hype - 30); } },
                    2012: { tipo: 'success', texto: 'üì± Mobile boom! Mobile games +50%', efecto: () => { this.gameState.hype = Math.min(100, this.gameState.hype + 30); } },
                    2017: { tipo: 'danger', texto: 'üé∞ Loot box controversy! Reputation -15%', efecto: () => { this.gameState.reputacion = Math.max(0, this.gameState.reputacion - 15); } },
                    2020: { tipo: 'success', texto: 'üè† Pandemic +200% digital sales!', efecto: () => { const bonus = 200000; this.gameState.caja += bonus; this.gameState.ingresosTotales += bonus; } },
                    2023: { tipo: 'warning', texto: 'üî• Mass layoffs! Hiring -50% cost', efecto: () => { this.gameState.descuentoContratacion = true; } }
                };

                this.inicializar();
            }

            inicializar() {
                this.configurarCanvas();
                this.configurarEventos();
                this.generarEmpleadosIniciales();
                this.iniciarLoop();
                this.iniciarTicks();
                this.mostrarNotificacion('üéÆ WELCOME', 'Press SPACE to speed up development');
            }

            configurarCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                window.addEventListener('resize', () => {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                });
            }

            configurarEventos() {
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.teclado.space = true;
                    }
                });
                document.addEventListener('keyup', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.teclado.space = false;
                    }
                });
            }

            iniciarLoop() {
                let ultimoTiempo = 0;
                const loop = (timestamp) => {
                    const deltaTime = timestamp - ultimoTiempo;
                    ultimoTiempo = timestamp;

                    this.actualizar(deltaTime);
                    this.renderizar();
                    requestAnimationFrame(loop);
                };
                requestAnimationFrame(loop);
            }

            iniciarTicks() {
                setInterval(() => {
                    this.tick();
                }, this.config.tickSpeed);
            }

            tick() {
                // Advance time
                this.gameState.mes++;
                if (this.gameState.mes > 12) {
                    this.gameState.mes = 1;
                    this.gameState.a√±o++;
                    this.agregarEvento('info', `üìÖ Year ${this.gameState.a√±o}`);
                }

                // Auto-develop project if space is held
                if (this.teclado.space && this.gameState.proyectoActivo) {
                    this.desarrollarProyecto();
                }

                // Check historical events
                if (this.gameState.mes === 6 && this.eventosHistoria[this.gameState.a√±o]) {
                    const evento = this.eventosHistoria[this.gameState.a√±o];
                    this.agregarEvento(evento.tipo, evento.texto);
                    evento.efecto();
                }

                this.actualizarUI();
            }

            actualizar(deltaTime) {
                this.gameState.empleados.forEach(empleado => empleado.actualizar(deltaTime));
                this.sistemaParticulas = this.sistemaParticulas.filter(p => p.actualizar(deltaTime));
            }

            renderizar() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.dibujarOficina();
                this.gameState.empleados.forEach(empleado => empleado.dibujar(this.ctx));
                this.sistemaParticulas.forEach(p => p.dibujar(this.ctx));
            }

            dibujarOficina() {
                const ctx = this.ctx;
                const tile = this.config.tamanoTile;
                const offsetX = this.config.offsetX + this.canvas.width / 2 - 300;
                const offsetY = this.config.offsetY + this.canvas.height / 2 - 200;

                // Grid isom√©trico
                ctx.strokeStyle = 'rgba(100,100,100,0.1)';
                ctx.lineWidth = 1;

                for (let x = 0; x < 20; x++) {
                    for (let y = 0; y < 20; y++) {
                        const isoX = (x - y) * tile / 2 + offsetX;
                        const isoY = (x + y) * tile / 4 + offsetY;
                        ctx.strokeRect(isoX, isoY, tile, tile / 2);
                    }
                }

                // Workstations
                ctx.fillStyle = '#444';
                const workstations = Math.min(this.gameState.equipo, 20);
                for (let i = 0; i < workstations; i++) {
                    const x = i % 5;
                    const y = Math.floor(i / 5);
                    const isoX = (x - y) * tile / 2 + offsetX + 100;
                    const isoY = (x + y) * tile / 4 + offsetY + 50;
                    
                    ctx.fillRect(isoX, isoY, tile * 0.8, tile * 0.4);
                    ctx.fillStyle = '#222';
                    ctx.fillRect(isoX + 5, isoY - 10, tile * 0.6, tile * 0.2);
                    ctx.fillStyle = '#444';
                }
            }

            // üéÆ GAME MECHANICS
            generarEmpleadosIniciales() {
                const nombres = ['Alex', 'Sam', 'Jordan', 'Taylor', 'Morgan', 'Casey', 'Riley', 'Avery'];
                const apellidos = ['Dev', 'Coder', 'Designer', 'Artist', 'Tester', 'Producer'];
                
                for (let i = 0; i < 3; i++) {
                    this.gameState.empleados.push(new Empleado(
                        nombres[Math.floor(Math.random() * nombres.length)] + ' ' + apellidos[Math.floor(Math.random() * apellidos.length)],
                        200 + i * 150,
                        200 + i * 50,
                        this
                    ));
                }
            }

            hireEmployee() {
                const costo = this.gameState.descuentoContratacion ? 25000 : 50000;
                if (this.gameState.caja >= costo && this.gameState.equipo < this.gameState.maxEquipo) {
                    this.gameState.caja -= costo;
                    this.gameState.equipo++;
                    
                    const nombres = ['Alex', 'Sam', 'Jordan', 'Taylor', 'Morgan', 'Casey', 'Riley', 'Avery'];
                    const apellidos = ['Dev', 'Coder', 'Designer', 'Artist', 'Tester', 'Producer'];
                    const emp = new Empleado(
                        nombres[Math.floor(Math.random() * nombres.length)] + ' ' + apellidos[Math.floor(Math.random() * apellidos.length)],
                        200 + Math.random() * 400,
                        150 + Math.random() * 200,
                        this
                    );
                    this.gameState.empleados.push(emp);
                    
                    this.gameState.moral = Math.min(100, this.gameState.moral + 5);
                    this.mostrarNotificacion('üíº HIRED', `New team member: ${emp.nombre.split(' ')[0]}`);
                    this.agregarEvento('success', `Hired: ${emp.nombre}`);
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', this.gameState.equipo >= this.gameState.maxEquipo ? 'Max team size' : 'Insufficient funds');
                }
            }

            investMarketing() {
                const costo = 30000;
                if (this.gameState.caja >= costo) {
                    this.gameState.caja -= costo;
                    this.gameState.hype = Math.min(100, this.gameState.hype + 25);
                    this.mostrarNotificacion('üì¢ MARKETING', 'Campaign increased hype +25');
                    this.agregarEvento('info', 'Marketing campaign launched');
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', 'Insufficient funds');
                }
            }

            researchTech() {
                const costo = 75000;
                if (this.gameState.caja >= costo) {
                    this.gameState.caja -= costo;
                    this.gameState.nivelInvestigacion++;
                    this.mostrarNotificacion('üî¨ RESEARCH', `Level ${this.gameState.nivelInvestigacion} unlocked`);
                    this.agregarEvento('success', 'Research completed');
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', 'Insufficient funds');
                }
            }

            moveOffice() {
                const costo = 150000;
                if (this.gameState.caja >= costo && this.gameState.nivelEstudio < 5) {
                    this.gameState.caja -= costo;
                    this.gameState.nivelEstudio++;
                    this.gameState.maxEquipo += 25;
                    this.gameState.moral = Math.min(100, this.gameState.moral + 20);
                    this.mostrarNotificacion('üè¢ MOVED', `Office level ${this.gameState.nivelEstudio} unlocked`);
                    this.agregarEvento('success', `Office upgraded: +25 max team`);
                    this.actualizarUI();
                } else {
                    this.mostrarNotificacion('‚ùå ERROR', this.gameState.nivelEstudio >= 5 ? 'Max level reached' : 'Insufficient funds');
                }
            }

            toggleCrunch() {
                this.gameState.crunchMode = !this.gameState.crunchMode;
                document.getElementById('crunchStatus').textContent = this.gameState.crunchMode ? 'ON' : 'OFF';
                this.mostrarNotificacion('üî• CRUNCH', this.gameState.crunchMode ? 'ON: +speed, -morale' : 'OFF');
                this.agregarEvento(this.gameState.crunchMode ? 'warning' : 'info', `Crunch ${this.gameState.crunchMode ? 'ACTIVATED' : 'DISABLED'}`);
                this.actualizarUI();
            }

            takeContract() {
                const ingresos = 40000;
                this.gameState.caja += ingresos;
                this.gameState.ingresosTotales += ingresos;
                this.mostrarNotificacion('üìã CONTRACT', `+${ingresos / 1000}K secured`);
                this.agregarEvento('info', 'Contract work completed');
                this.actualizarUI();
            }

            startNewProject() {
                if (this.gameState.proyectoActivo) {
                    this.mostrarNotificacion('‚ö†Ô∏è ACTIVE PROJECT', 'Finish current game first');
                    return;
                }
                document.getElementById('newGameModal').classList.add('active');
            }

            continueProject() {
                if (!this.gameState.proyectoActivo) return;
                document.getElementById('continueBtn').classList.add('bouncing');
                setTimeout(() => document.getElementById('continueBtn').classList.remove('bouncing'), 300);
                this.desarrollarProyecto();
            }

            desarrollarProyecto() {
                const proyecto = this.gameState.proyectoActivo;
                if (!proyecto) return;

                const velocidad = this.gameState.crunchMode ? 25 : 15;
                const penalidad = this.gameState.crunchMode ? 3 : 0;

                proyecto.progreso += velocidad;
                this.gameState.moral = Math.max(0, this.gameState.moral - penalidad);

                // Random events
                if (Math.random() < 0.1) this.eventoDesarrolloRandom();

                // Complete project
                if (proyecto.progreso >= 100) {
                    this.lanzarJuego();
                }

                this.actualizarUI();
            }

            eventoDesarrolloRandom() {
                const eventos = [
                    { tipo: 'warning', texto: 'üêõ Critical bug! -10% progress', efecto: () => { this.gameState.proyectoActivo.progreso -= 10; } },
                    { tipo: 'success', texto: '‚≠ê Team star! +15% progress', efecto: () => { this.gameState.proyectoActivo.progreso += 15; } },
                    { tipo: 'info', texto: 'üí° Inspiration! +5 quality', efecto: () => { this.gameState.proyectoActivo.calidad += 5; } }
                ];
                const evento = eventos[Math.floor(Math.random() * eventos.length)];
                evento.efecto();
                this.agregarEvento(evento.tipo, evento.texto);
            }

            lanzarJuego() {
                const proyecto = this.gameState.proyectoActivo;
                const nota = this.calcularNotaFinal(proyecto);
                const ventas = this.calcularVentas(proyecto, nota);

                // Update state
                this.gameState.caja += ventas;
                this.gameState.ingresosTotales += ventas;
                this.gameState.juegos.push({...proyecto, nota, ventas, a√±o: this.gameState.a√±o, mes: this.gameState.mes});

                // Update reputation
                const cambioRep = nota > 80 ? 8 : nota > 60 ? 3 : -5;
                this.gameState.reputacion = Math.max(0, Math.min(100, this.gameState.reputacion + cambioRep));
                this.gameState.hype = Math.max(10, this.gameState.hype - 30);
                this.gameState.moral = Math.min(100, this.gameState.moral + 10);

                // Clear project
                this.gameState.proyectoActivo = null;
                document.getElementById('activeProject').classList.remove('active');
                document.getElementById('newGameBtn').style.display = 'block';
                document.getElementById('continueBtn').style.display = 'none';

                // Show review
                this.mostrarReview(nota, ventas);

                this.agregarEvento(nota > 80 ? 'success' : nota > 60 ? 'info' : 'danger',
                    `üéÆ ${this.baseDatos.generos[proyecto.genero].nombre} launched: ${nota.toFixed(1)}/100`);
                
                this.comprobarLogros();
            }

            calcularNotaFinal(proyecto) {
                const genero = this.baseDatos.generos[proyecto.genero];
                const tema = this.baseDatos.temas[proyecto.tema];
                const plataforma = this.baseDatos.plataformas[proyecto.plataforma];
                
                const a√±oIndex = Math.min(9, Math.floor((this.gameState.a√±o - 2000) / 3));
                const tendencia = genero.tendencia[a√±oIndex];
                
                let nota = genero.base * tendencia;
                nota *= (tema.multi[proyecto.genero] || 1);
                nota *= (proyecto.presupuesto / 100000) * 0.5 + 0.5;
                nota *= (this.gameState.reputacion / 100);
                nota *= (this.gameState.moral / 100) * 0.3 + 0.7;
                nota *= (this.gameState.equipo / 3) * 0.2 + 0.8;
                nota *= 0.9 + Math.random() * 0.2;

                return Math.min(100, Math.max(0, nota));
            }

            calcularVentas(proyecto, nota) {
                const base = proyecto.presupuesto * 3;
                const bonusNota = (nota - 50) / 50;
                const bonusHype = this.gameState.hype / 100;
                const a√±oMulti = this.gameState.a√±o < 2010 ? 0.8 : this.gameState.a√±o < 2020 ? 1.0 : 1.2;
                return Math.floor(base * (1 + bonusNota) * (1 + bonusHype) * a√±oMulti);
            }

            mostrarReview(nota, ventas) {
                document.getElementById('reviewScore').textContent = nota.toFixed(0);
                const stars = '‚òÖ'.repeat(Math.floor(nota / 20)) + '‚òÜ'.repeat(5 - Math.floor(nota / 20));
                document.getElementById('reviewStars').textContent = stars;
                document.getElementById('salesFigure').textContent = `$${(ventas / 1000).toFixed(0)}K`;
                document.getElementById('unitsSold').textContent = `${(ventas / 10).toFixed(0)}K`;
                
                const comentarios = nota >= 90 ? "Masterpiece! Game of the Year." :
                                  nota >= 80 ? "Excellent! Must buy." :
                                  nota >= 70 ? "Good game with minor flaws." :
                                  nota >= 60 ? "Average experience." :
                                  "Poor execution. Needs work.";
                document.getElementById('reviewComments').textContent = comentarios;
                
                document.getElementById('reviewModal').classList.add('active');
            }

            closeReview() {
                document.getElementById('reviewModal').classList.remove('active');
            }

            selectOption(element) {
                const type = element.dataset.type;
                document.querySelectorAll(`[data-type="${type}"]`).forEach(el => el.classList.remove('selected'));
                element.classList.add('selected');
            }

            confirmProject() {
                const genero = document.querySelector('[data-type="genre"].selected')?.dataset.value;
                const tema = document.querySelector('[data-type="tema"].selected')?.dataset.value;
                const plataforma = document.querySelector('[data-type="plataforma"].selected')?.dataset.value;
                const presupuesto = parseInt(document.getElementById('budgetSlider').value);

                if (!genero || !tema || !plataforma) {
                    this.mostrarNotificacion('‚ùå ERROR', 'Select all options');
                    return;
                }

                if (this.gameState.caja < presupuesto) {
                    this.mostrarNotificacion('‚ùå ERROR', `Need $${presupuesto.toLocaleString()}`);
                    return;
                }

                this.gameState.caja -= presupuesto;
                this.gameState.proyectoActivo = {
                    genero, tema, plataforma, presupuesto,
                    progreso: 0, calidad: 0
                };

                document.getElementById('newGameModal').classList.remove('active');
                document.querySelectorAll('.option-tile').forEach(el => el.classList.remove('selected'));
                
                this.mostrarNotificacion('üéÆ PROJECT STARTED', `${this.baseDatos.generos[genero].nombre}`);
                this.agregarEvento('success', `Started: ${this.baseDatos.generos[genero].nombre} / ${this.baseDatos.temas[tema].nombre}`);
                this.actualizarUI();
            }

            updateBudget(valor) {
                document.getElementById('budgetValue').textContent = `$${(valor / 1000).toFixed(0)}K`;
            }

            actualizarUI() {
                // Update stats
                document.getElementById('uiCash').textContent = `$${(this.gameState.caja / 1000).toFixed(0)}K`;
                document.getElementById('uiYear').textContent = `${this.gameState.a√±o}-${this.gameState.mes.toString().padStart(2, '0')}`;
                document.getElementById('uiTeam').textContent = `${this.gameState.equipo} / ${this.gameState.maxEquipo}`;
                document.getElementById('uiRep').textContent = `${this.gameState.reputacion}%`;
                document.getElementById('uiHype').textContent = `${this.gameState.hype}%`;
                
                document.getElementById('cashBar').style.width = `${Math.min(100, this.gameState.caja / 5000)}%`;
                document.getElementById('teamBar').style.width = `${(this.gameState.equipo / this.gameState.maxEquipo) * 100}%`;
                document.getElementById('repBar').style.width = `${this.gameState.reputacion}%`;
                document.getElementById('hypeBar').style.width = `${this.gameState.hype}%`;
                
                // Update project panel
                if (this.gameState.proyectoActivo) {
                    document.getElementById('activeProject').classList.add('active');
                    document.getElementById('newGameBtn').style.display = 'none';
                    document.getElementById('continueBtn').style.display = 'block';
                    document.getElementById('projectName').textContent = 
                        `${this.baseDatos.generos[this.gameState.proyectoActivo.genero].nombre}`;
                    document.getElementById('projectProgress').textContent = `${this.gameState.proyectoActivo.progreso}%`;
                    document.getElementById('progressBar').style.width = `${this.gameState.proyectoActivo.progreso}%`;
                } else {
                    document.getElementById('activeProject').classList.remove('active');
                    document.getElementById('newGameBtn').style.display = 'block';
                    document.getElementById('continueBtn').style.display = 'none';
                }

                this.actualizarListaEmpleados();
                this.comprobarLogros();
            }

            actualizarListaEmpleados() {
                const container = document.getElementById('employeeList');
                container.innerHTML = '';
                
                this.gameState.empleados.slice(0, 8).forEach(empleado => {
                    const div = document.createElement('div');
                    div.className = 'ui-stat';
                    div.style.fontSize = '9px';
                    div.innerHTML = `
                        <span>${empleado.nombre.split(' ')[0]}</span>
                        <span style="color: ${empleado.moral > 60 ? '#00ff41' : '#ffcc00'}">${empleado.moral}%</span>
                    `;
                    container.appendChild(div);
                });
            }

            comprobarLogros() {
                if (this.gameState.juegos.length === 1 && !this.logros.primero.desbloqueado) {
                    this.desbloquearLogro(this.logros.primero);
                }
                if (this.gameState.juegos.length >= 10 && !this.logros.experto.desbloqueado) {
                    this.desbloquearLogro(this.logros.experto);
                }
                if (this.gameState.ingresosTotales >= 1000000 && !this.logros.millonario.desbloqueado) {
                    this.desbloquearLogro(this.logros.millonario);
                }
                const hit = this.gameState.juegos.find(j => j.nota >= 85);
                if (hit && !this.logros.hit.desbloqueado) {
                    this.desbloquearLogro(this.logros.hit);
                }
            }

            desbloquearLogro(logro) {
                logro.desbloqueado = true;
                document.getElementById('achievementTitle').textContent = `üèÜ ${logro.nombre}`;
                document.getElementById('achievementDesc').textContent = logro.descripcion;
                document.getElementById('achievementPopup').classList.add('active');
                setTimeout(() => document.getElementById('achievementPopup').classList.remove('active'), 4000);
                this.agregarEvento('success', `üèÜ Achievement: ${logro.nombre}!`);
            }

            agregarEvento(tipo, texto) {
                const log = document.getElementById('eventLog');
                const evento = document.createElement('div');
                evento.className = `event-item ${tipo}`;
                evento.innerHTML = `<div class="event-header">${this.gameState.a√±o}-${this.gameState.mes.toString().padStart(2, '0')}</div>${texto}`;
                log.insertBefore(evento, log.firstChild);
                while (log.children.length > 20) log.removeChild(log.lastChild);
            }

            mostrarNotificacion(titulo, texto) {
                document.getElementById('notificationTitle').textContent = titulo;
                document.getElementById('notificationText').textContent = texto;
                const notif = document.getElementById('notification');
                notif.classList.add('show');
                setTimeout(() => notif.classList.remove('show'), 3000);
            }

            resetGame() {
                if (confirm('üîÑ Start new game? All progress will be lost!')) {
                    localStorage.removeItem('industrySimGOTY');
                    location.reload();
                }
            }

            guardarJuego() {
                try {
                    localStorage.setItem('industrySimGOTY', JSON.stringify(this.gameState));
                    document.getElementById('saveIndicator').classList.add('show');
                    setTimeout(() => document.getElementById('saveIndicator').classList.remove('show'), 1000);
                } catch (e) {
                    console.warn('Could not save game:', e);
                }
            }

            cargarJuego() {
                try {
                    const guardado = localStorage.getItem('industrySimGOTY');
                    if (guardado) {
                        const data = JSON.parse(guardado);
                        Object.assign(this.gameState, data);
                        this.gameState.empleados = this.gameState.empleados.map(e => {
                            const emp = new Empleado(e.nombre, e.x, e.y, this);
                            Object.assign(emp, e);
                            return emp;
                        });
                        this.mostrarNotificacion('üìÇ SAVED GAME LOADED', `Year ${this.gameState.a√±o}`);
                    }
                } catch (e) {
                    console.warn('Could not load game:', e);
                }
            }
        }

        // üéÆ EMPLOYEE CLASS
        class Empleado {
            constructor(nombre, x, y, juego) {
                this.nombre = nombre;
                this.x = x;
                this.y = y;
                this.juego = juego;
                this.moral = 75;
                this.habilidad = Math.random() * 0.5 + 0.5;
                this.estado = 'idle';
                this.frame = 0;
                this.velocidad = 2;
                this.destinoX = x;
                this.destinoY = y;
                this.color = `hsl(${Math.random() * 360}, 70%, 50%)`;
            }

            actualizar(deltaTime) {
                this.frame += deltaTime * 0.01;

                if (this.estado === 'walk') {
                    const dx = this.destinoX - this.x;
                    const dy = this.destinoY - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist > 5) {
                        this.x += (dx / dist) * this.velocidad;
                        this.y += (dy / dist) * this.velocidad;
                    } else {
                        this.estado = 'idle';
                    }
                }

                if (Math.random() < 0.0005) {
                    this.caminarAleatorio();
                }
            }

            dibujar(ctx) {
                const size = 16;
                const x = this.x - size / 2;
                const y = this.y - size / 2;

                ctx.fillStyle = this.color;
                ctx.fillRect(x, y, size, size);
                ctx.fillStyle = '#fdbcb4';
                ctx.fillRect(x + 4, y - 8, 8, 8);

                if (this.estado === 'work') {
                    ctx.fillStyle = 'rgba(0, 184, 255, 0.3)';
                    ctx.fillRect(x - 2, y - 2, size + 4, size + 4);
                }
            }

            caminarAleatorio() {
                this.destinoX = 200 + Math.random() * 400;
                this.destinoY = 150 + Math.random() * 200;
                this.estado = 'walk';
            }
        }

        // üéÆ PARTICLE SYSTEM
        class Particula {
            constructor(x, y, color, vx, vy, vida) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.vx = vx;
                this.vy = vy;
                this.vida = vida;
                this.maxVida = vida;
            }

            actualizar(deltaTime) {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.1;
                this.vida -= deltaTime;
                return this.vida > 0;
            }

            dibujar(ctx) {
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.vida / this.maxVida;
                ctx.fillRect(this.x, this.y, 4, 4);
                ctx.globalAlpha = 1;
            }
        }

        // üéÆ START GAME
        window.addEventListener('load', () => {
            window.game = new IndustryEvolutionSimulator();
            window.game.cargarJuego();
            setInterval(() => game.guardarJuego(), 60000);
        });
    </script>
</body>
</html>
